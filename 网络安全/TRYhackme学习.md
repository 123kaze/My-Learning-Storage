

# TryHackMe学习 

## 1.第一次尝试

首先，在终端中输入以下命令，使用Gobuster（命令行安全应用程序）查找 FakeBank 网站上可能隐藏的页面。

```bash
gobuster -u http://fakebank.thm -w wordlist.txt dir
```

-u表示搜寻的网址，-w表示依靠单词列表进行迭代查询寻找隐藏的界面

找到隐藏界面登录，即可渗透。 

## 2.防御性概要

### 防御性安全简介

在上一个房间里，我们了解了进攻性安全性，它旨在识别和利用系统漏洞来增强安全措施。这包括利用软件错误、利用不安全的设置以及利用未强制执行的访问控制策略等策略。红队和渗透测试人员专门研究这些进攻技术。

在这个房间里，我们将研究它的对应物，防御性安全。它涉及两个主要任务：

1. 防止入侵发生
2. 在入侵发生时进行检测并正确响应

蓝队是防御性安全形势的一部分。

 

与防御性安全相关的一些任务包括：

- 用户网络安全意识：对用户进行网络安全培训有助于防范针对其系统的攻击。
- 记录和管理资产：我们需要了解我们必须充分管理和保护的系统和设备。
- 更新和修补系统：确保计算机、服务器和网络设备得到正确更新和修补，以应对任何已知的漏洞（弱点）。
- 设置预防性安全设备： 防火墙和入侵防御系统 （IPS） 是预防性安全的关键组成部分。防火墙控制哪些网络流量可以进入内部，哪些网络流量可以离开系统或网络。IPS 会阻止与当前规则和攻击签名匹配的任何网络流量。
- 设置日志记录和监控设备：适当的网络日志记录和监控对于检测恶意活动和入侵至关重要。如果我们的网络上出现新的未经授权的设备，我们应该能够检测到它。

防御性安全远不止于此。除上述内容外，我们还将介绍以下相关主题：

- 安全运营中心 （SOC）
- 威胁情报
- 数字取证和事件响应 （DFIR）
- 恶意软件分析



### 数字取证和事件响应 （DFIR）

本部分介绍数字取证和事件响应 （DFIR）， 我们将介绍：

- 数字取证
- 事件响应
- 恶意软件分析

**数字取证：**

在防御性安全方面，数字取证的重点转移到分析攻击及其肇事者的证据，以及其他领域，例如知识产权盗窃、网络间谍和拥有未经授权的内容。因此，数字取证将侧重于不同的领域，例如：

- 文件系统 ：分析系统存储的数字取证图像（低级副本）可以揭示许多信息，例如已安装的程序、创建的文件、部分覆盖的文件和已删除的文件。
- 系统内存：如果攻击者在内存中运行恶意程序，但未将其保存到磁盘，则获取系统内存的取证图像（低级副本）是分析其内容并了解攻击的最佳方式。
- 系统日志：每个客户端和服务器计算机都维护着不同的日志文件，说明发生了什么。日志文件提供了有关系统上所发生情况的大量信息。即使攻击者试图清除他们的痕迹，一些痕迹也会保留下来。
- 网络日志：遍历网络的网络数据包的日志将有助于回答有关是否发生攻击及其后果的更多问题。

**事件响应：**

事件响应 指定了处理此类情况应遵循的方法。目的是在尽可能短的时间内减少损害和恢复。理想情况下，您将制定一个为事件响应做好准备的计划。

事件响应过程的四个主要阶段是：

1. 准备：这需要一支经过培训并准备好处理事件的团队。理想情况下，采取各种措施来从一开始就防止事件发生。
2. 检测和分析： 团队拥有检测任何事件所需的资源;此外，必须进一步分析检测到的任何事件以了解其严重性。
3. 遏制、根除和恢复：一旦检测到事件，就必须阻止它影响其他系统，消除它并恢复受影响的系统。例如，当我们注意到某个系统感染了计算机病毒时，我们希望阻止（遏制）病毒传播到其他系统，清理（根除）病毒，并确保系统正确恢复。
4. 事件后活动：成功恢复后，将生成报告，并分享经验教训，以防止将来发生类似的事件。

![Incidence Response Flowchart](D:\Typora\保存文档\网络安全\assets\b162600f5990f249d921aa0e8b7822f7.png)

**恶意软件分析：**

恶意软件代表恶意软件。 *软件*是指可以保存在磁盘上或通过网络发送的程序、文档和文件。恶意软件包括多种类型，例如：

- 病毒是将自身附加到程序上的一段代码（程序的一部分）。它旨在从一台计算机传播到另一台计算机，其工作原理是在感染计算机后更改、覆盖和删除文件。结果范围从计算机变慢到无法使用。
- 特洛伊木马是一种程序，它显示一个理想的功能，但在下面隐藏了一个恶意功能。例如，受害者可能会从可疑网站下载视频播放器，从而使攻击者能够完全控制其系统。
- 勒索软件是一种加密用户文件的恶意程序。加密会使文件在不知道加密密码的情况下无法读取。如果用户愿意支付 “赎金”，攻击者会向用户提供加密密码。

恶意软件分析旨在通过各种方式了解此类恶意程序：

1. 静态分析的工作原理是检查恶意程序而不运行它。这通常需要扎实的汇编语言（处理器的指令集，即计算机的基本指令）的知识。
2. 动态分析的工作原理是在受控环境中运行恶意软件并监控其活动。它允许您观察恶意软件在运行时的行为方式。

 *Security Information and Event Management* (SIEM)   安全信息事件管理



### 学习路径

TryHackMe 的学习路径将为您提供基本的技术知识和实践经验，这对于成为一名成功的安全分析师至关重要。

- [安检前](https://tryhackme.com/path/outline/presecurity/)
- [网络安全 101](https://tryhackme.com/path/outline/cybersecurity101)
- [SOC （有机碳 ）1 级](https://tryhackme.com/path/outline/soclevel1)

### 相关职业指南

- [成为网络安全分析师](https://tryhackme.com/r/careers/cyber-security-analyst)
- [如何成为 1 级 SOC 分析师](https://tryhackme.com/r/resources/blog/become-level-1-soc-analyst)
- [SOC 分析师的一天](https://tryhackme.com/r/resources/blog/interview-with-soc-analyst)
- [终极 SOC L1 分析师访谈指南](https://tryhackme.com/r/resources/blog/soc-analyst-interview-guide)
- [从学生到 SOC 分析师：Hayden 的成功案例](https://tryhackme.com/r/resources/blog/haydens-success-story)



### 学习路径

TryHackMe 的学习路径将为您提供基本的技术知识和实践经验，这对于成为一名成功的安全工程师至关重要。

- [SOC （有机碳 ）1 级](https://tryhackme.com/path/outline/soclevel1)
- [JR 触探测试仪](https://tryhackme.com/path/outline/jrpenetrationtester)
- [冒犯性渗透测试](https://tryhackme.com/path/outline/pentesting)

### 相关职业指南

- [成为安全工程师](https://tryhackme.com/r/careers/security-engineer)
- [如何成为安全工程师](https://tryhackme.com/r/resources/blog/become-security-engineer)
- [安全工程师的一天](https://tryhackme.com/r/resources/blog/interview-with-security-engineer)
- [准备安全工程面试](https://tryhackme.com/r/resources/blog/security-engineer-interview-guide)
- [成为一名安全工程师：Richárd 的成功案例](https://tryhackme.com/r/resources/blog/richard-success-story)

### 学习路径

TryHackMe 的学习路径将为您提供基本的技术知识和实践经验，这对于成为一名成功的渗透测试人员至关重要。

- [JR 触探测试仪](https://tryhackme.com/path/outline/jrpenetrationtester)
- [冒犯性渗透测试](https://tryhackme.com/path/outline/pentesting)

### 相关职业指南

- [成为渗透测试人员](https://tryhackme.com/r/careers/penetration-tester)
- [如何成为渗透测试员](https://tryhackme.com/r/resources/blog/how-to-become-a-penetration-tester)
- [准备初级渗透测试员面试](https://tryhackme.com/r/resources/blog/jr-pentester-interview-guide)
- [从 IT 支持到渗透测试员：Tom 的成功案例](https://tryhackme.com/r/resources/blog/tom-success-story)

现在我们可以通过改名契约来更改我们的名字，但是我们不能更改我们的指纹。每个人都有一组单独的指纹，这意味着即使他们改变了名字，背后仍然有一个身份。设备具有相同的功能：两种识别方式，一种是可渗透的。这些是：

- 一个 IP 地址
- 媒体访问控制 （MAC） 地址 -- 将其视为类似于序列号。

**MAC 地址
**

网络上的设备都将具有物理网络接口，该接口是设备主板上的微芯片板。此网络接口在制造它的工厂被分配了一个唯一的地址，称为 **MAC** （**M**edia **A**ccess **C**ontrol） 地址。MAC 地址是一个 **12 个字符的**十六进制数字（ *计算中用于表示数字的 16 进制编号系统* ），分为两部分，并用冒号分隔。这些冒号被视为分隔符。例如，*a4：c3：f0：85：ac：2d*。前 6 个字符表示制作网络接口的公司，后 6 个字符是唯一的数字.

![img](D:\Typora\保存文档\网络安全\assets\394caee97fb1b9f7b5a5f7a7ea0a9f71.png)

但是，MAC 地址的一个有趣之处在于，它们可以在称为欺骗的过程中被伪造或“欺骗”。当联网设备使用其 MAC 地址假装身份为另一个设备时，就会发生这种欺骗。发生这种情况时，它通常会破坏实施不佳的安全设计，这些设计假设在网络上通信的设备是可信的。以以下场景为例： 防火墙配置为允许与管理员的 MAC 地址之间的任何通信。如果设备要伪装或“欺骗”此 MAC 地址， 防火墙现在会认为它正在接收来自管理员的通信，而实际上并非如此。

## ping

Ping 是我们可用的最基本的网络工具之一。Ping 使用 **ICMP** （**I**nternet **C**ontrol **M**essage **P**rotocol） 数据包来确定设备之间连接的性能，例如，连接是否存在或可靠。

执行简单 ping 的语法是 `ping IP address or website URL` . ping -c ip也行

## Linux学习 PART1

Let's get started with two of the first commands which I have broken down in the table below:

| Command | Description                                      |
| ------- | ------------------------------------------------ |
| echo    | Output any text that we provide                  |
| whoami  | Find out what user we're currently logged in as! |

```shell-session
tryhackme@linux1:~$ echo Hello
Hello
tryhackme@linux1:~$ echo "Hello Friend!"
Hello Friend!
```

如上面的终端所示，如果我们想 “echo” 单个单词，我们不需要使用双引号，例如 `echo Hello`。但是，如果存在一个或多个空格，则字符串应括在双引号中，例如 `echo “Hello Friend！”。`

`whoami` 可用于查找我们登录时使用的用户名。

### 与文件系统交互


正如我之前所说，能够在不依赖桌面环境的情况下导航您登录的计算机非常重要。毕竟，如果我们哪儿都去不了，登录又有什么意义呢？

| Command | Full Name                               |
| ------- | --------------------------------------- |
| ls      | listing列出清单                         |
| cd      | change directory改变当前位置            |
| cat     | concatenate建立连接，输出文件内容       |
| pwd     | print working directory输出工作地点位置 |



#### 列出当前目录中的文件 （ls）

 

在我们做任何事情（例如找出任何文件或文件夹的内容）之前，我们首先需要知道存在什么。这可以使用 “ls” 命令（列表的缩写）来完成

####  输出文件的内容 （cat）

虽然了解文件的存在很好，但除非我们能够查看文件的内容，否则它并不是那么有用。

我们将继续讨论一些可用的工具，这些工具允许我们在以后的房间里将文件从一台机器传输到另一台机器。但现在，我们将讨论使用名为 “**cat”** 的命令简单地查看文本文件的内容。

“**cat**”是连接词的缩写，是我们输出文件内容（不仅仅是文本文件）的绝佳方式。

在下面的屏幕截图中，您可以看到我如何结合使用“ls”来列出名为“Documents”的目录中的文件：

```
tryhackme@linux1:~/Documents$ ls
todo.txt
tryhackme@linux1:~/Documents$ cat todo.txt
Here's something important for me to do later!
```

*专业提示：您可以使用 cat 输出目录中的文件内容，而无需使用 cat 和目录名称导航到该文件。即* `cat /home/ubuntu/Documents/todo.txt`

#### find

 展示使用此类系统的效率的一种绝妙方法是使用一组命令在整个系统中快速搜索用户有权访问的文件。无需始终使用 cd 和 ls 来找出什么在哪里。相反，我们可以使用 find 等 命令来为我们自动化这样的事情！

让我们从简单开始，假设我们已经知道我们要查找的文件的名称 — 但记不清它的确切位置！在本例中，我们正在寻找 “passwords.txt”

如果我们记得文件名，我们可以简单地使用 find -name passwords.txt 命令将查找当前目录中的每个文件夹以查找该特定文件，如下所示：

```
tryhackme@linux1:~$ find -name passwords.txt
./folder1/passwords.txt
tryhackme@linux1:~$
```

但是，假设我们不知道文件名，或者想要搜索具有 “.txt” 等扩展名的每个文件。查找让我们也这样做！

我们可以简单地使用所谓的通配符 （*） 来搜索末尾有 .txt 的任何内容。在我们的例子中，我们希望找到当前目录中的所有 .txt 文件。我们将构造一个命令，例如 **find -name *.txt** 。其中 “Find” 能够找到每个 .txt 文件，然后为我们提供了每个文件的位置：

```
tryhackme@linux1:~$ find -name *.txt     //这里加一个-name，但是windos不加。
./folder1/passwords.txt
./Documents/todo.txt
tryhackme@linux1:~$
```

**他只能找当前cd区域里面的，不能找全局的**

#### 使用 Grep

另一个值得学习的出色实用程序是 grep 的使用。grep 命令允许我们在文件内容中搜索我们正在寻找的特定值。

```
ryhackme@linux1:~$ wc -l access.log  //wc -l xxx.log  显示有多少个条目
244 access.log
tryhackme@linux1:~$
```

我们可以使用 `grep `搜索此文件的全部内容，以查找我们正在搜索的值的任何条目。以 Web 服务器的访问日志为例，我们想要查看 IP 地址 “81.143.211.90” 访问过的所有内容（请注意，这是虚构的）

```
tryhackme@linux1:~$ grep "81.143.211.90" access.log
81.143.211.90 - - [25/Mar/2021:11:17 + 0000] "GET / HTTP/1.1" 200 417 "-" "Mozilla/5.0 (Linux; Android 7.0; Moto G(4))"
tryhackme@linux1:~$
```

命令 `grep "搜寻的东西" 搜寻的文档 `

## shell运算符

Linux 运算符是增强 Linux 使用知识的绝佳方式。有几个重要的运算符值得注意。我们将介绍基础知识，并将它们相应地分解为小块。

在概述中，我将展示以下运算符：

| 符号 / 运算符 | 描述                                                         |
| ------------- | ------------------------------------------------------------ |
| &             | 此运算符允许您在终端的后台运行命令。                         |
| &&            | 此运算符允许您将多个命令组合到终端的一行中。                 |
| >             | 这个运算符是一个重定向器 - 这意味着我们可以从命令中获取输出（例如使用 cat 输出文件）并将其定向到其他地方。 |
| >>            | 此运算符执行与 `>` 运算符相同的功能，但附加输出而不是替换（意味着不会覆盖任何内容）。 |



### 运算符 “&”

此运算符允许我们在后台执行命令。例如，假设我们想要复制一个大文件。这显然需要相当长的时间，并且在文件成功复制之前，我们无法执行任何其他作。

“&” shell 运算符允许我们执行命令并使其在后台运行（例如此文件副本），从而允许我们执行其他作！

### 运算符“&&”

这个 shell 运算符在它的伙伴 “&” 的熟悉程度上有点误导。与“&”运算符不同，我们可以使用“&&”来列出要运行的命令，例如 command1 && command2。但是，值得注意的是，command2 仅在 command1 成功时运行。**也就是有个先后顺序**

### 作员 “>”

此运算符称为 output redirector。这实质上意味着我们从运行的命令中获取输出，并将该输出发送到其他地方。

一个很好的例子是重定向我们在任务 4 中学到的 `echo` 命令的输出。当然，运行 `echo howdy` 之类的作会将 “howdy” 返回给我们的终端 — 这并不是特别有用。相反，我们可以做的是将 “howdy” 重定向到新文件之类的内容！

假设我们想创建一个名为 “welcome” 的文件，其中包含消息 “hey”。我们可以在希望创建内容为 “hey” 的文件的地方运行 `echo hey > welcome`，如下所示：

```
tryhackme@linux1:~$ echo hey > welcome
tryhackme@linux1:~$ cat welcome
hey
```

*注意：如果文件 “welcome” 已经存在，则内容将被覆盖！*

### 作员 “>>”

此运算符也是一个输出重定向器，就像我们讨论的上一个运算符 （`>`） 一样。但是，此运算符的不同之处在于，它不是覆盖文件中的任何内容，而是仅将输出放在末尾。 输出会变成 hey hello

### PART1总结

为了快速回顾一下，我们介绍了以下内容：

- 了解为什么 Linux 在今天如此普遍
- 与您的第一台 Linux 计算机交互！
- 已运行一些最基本的命令
- 介绍了如何在文件系统中导航以及我们如何使用像 find 和 grep 这样的命令来使查找数据更加高效！
- 通过了解一些重要的 shell 运算符来增强您的命令。

## PART2 目标

在第 2 部分中，我们将放弃浏览器内功能，并帮助您开始学习能够登录和控制远程机器终端的基本技能。不仅如此，房间还将为您提供：

- **通过向您介绍使用标志和参数来释放前几个命令的潜力**
- **提高您对文件系统的了解，以执行一些更有用的命令，例如复制和移动文件**
- **了解如何管理对文件和文件夹的访问，以及我们如何确定我们的访问权限。**

- **运行您的前几个脚本和可执行文件！**

### 什么是 SSH，它是如何运作的？

Secure Shell 或 SSH 只是设备之间以加密形式存在的协议。使用加密技术，我们以人类可读格式发送的任何输入都经过加密，以便在网络上传输一旦到达远程计算机，它就会被取消加密，如下图所示。![](D:\Typora\保存文档\网络安全\assets\154f110d35efe47d493df29cdb773109-1751524706778-3.svg)



- SSH 允许我们在另一台设备上远程执行命令。
- 在设备之间发送的任何数据在通过 Internet 等网络发送时都会被加密

**使用 SSH 登录到 Linux 计算机**

使用 SSH 的语法非常简单。我们只需要提供两件事：

1. 远程计算机的 IP 地址
2. 将凭据更正为有效帐户，以便在远程计算机上登录

例如： `ssh tryhackme@10.10.100.52 `.将 IP 地址替换为 Linux 目标计算机的 IP 地址。执行后，我们将被要求信任主机，然后为 “tryhackme” 帐户提供密码，该密码也是 “tryhackme”。

### flag 和 switch

大多数命令都允许提供参数。这些参数由连字符和称为 flags 或 switches 的特定关键字标识。

我们稍后将讨论如何识别哪些命令允许提供参数，并了解这些命令的确切作用。

**使用命令时，除非另有说明，否则它将执行其默认行为。例如，`ls` 列出工作目录的内容。但是，不会显示隐藏的文件。我们可以使用 flags 和 switch 来扩展命令的行为。**

使用我们的 `ls` 示例，`ls` 告诉我们只有一个名为 “folder1” 的文件夹，如下面的屏幕截图中突出显示的那样。 请注意，下面屏幕截图中的内容只是示例。

**但是，在使用 `-a` 参数（-`-all` 的缩写）后 ，我们现在突然有一个包含更多文件和文件夹的输出，例如“.hiddenfolder”。带有 “.” 的文件和文件夹是隐藏文件。**  //输入-a可以查到隐藏文件

接受这些选项的命令也将具有 `--help` 选项。此选项将列出命令接受的可能选项，并提供如何使用它的简要说明和示例。输入--help得到帮助

#### 菜单页面

手册页是系统命令和应用程序的重要信息来源 ，在 Linux 计算机上都可用，可以在计算机本身上访问，也可以[在线](https://linux.die.net/man/)访问。

要访问此文档，我们可以使用 `man `命令，然后提供我们想要阅读其文档的命令。使用我们的 ls 示例，我们将使用 `man ls` 来查看 `ls` 的手册页，如下所示：

### 文件交互系统2

我们介绍了在 Linux 机器上与文件系统交互时的一些最基本的命令。例如，我们介绍了如何使用 `ls` 列出和查找文件夹 的内容，以及 如何使用 `cd` `查找 ` 和导航文件系统。 

在这个任务中，我们将学习更多用于与文件系统交互的命令，以允许我们：

- 创建文件和文件夹
- 移动文件和文件夹
- 删除文件和文件夹

更具体地说，以下命令：

| 命令  | 全名           | 目的             |
| ----- | -------------- | ---------------- |
| touch | touch          | 创建文件         |
| mkdir | make directory | 创建文件夹       |
| cp    | copy           | 复制文件或文件夹 |
| mv    | move           | 移动文件或文件夹 |
| rm    | remove删除     | 移除文件或文件夹 |
| file  | file           | 确定文件类型     |

*专业提示：与使用 cat 类似，我们可以为所有这些命令提供完整的文件路径，即 directory1/directory2/note*

#### **创建文件和文件夹 （touch， mkdir）**

在 Linux 上创建文件和文件夹是一个简单的过程。首先，我们将介绍如何创建文件。touch 命令只接受一个参数 —— 我们想要为我们创建的文件指定的名称。例如，我们可以使用 `touch note` 创建文件 “note”。值得注意的是，触摸只会创建一个空白文件。 您需要使用 echo 等命令或 nano 等文本编辑器将内容添加到空白文件中。

#### **删除文件和文件夹 （rm）**

`rm` 在我们目前介绍的命令中非常出色。您可以简单地使用 `rm` 删除文件。但是，您需要在要删除的目录名称旁边提供 `-R` 开关。

```
tryhackme@linux2:~$ rm -R mydirectory //后面跟个-R
tryhackme@linux2:~$ ls           
folder1
```

#### **复制和移动文件和文件夹 （cp， mv）**

复制和移动文件是 Linux 计算机上的一项重要功能。从 `cp` 开始，此命令采用两个参数：

1. 现有文件的名称
2. 复制时我们希望为新文件分配的名称

`cp` 将现有文件的全部内容复制到新文件中。在下面的屏幕截图中，我们将“note”复制到“note2”。

```
tryhackme@linux2:~$ cp note note2
tryhackme@linux2:~$ ls           
folder1 note note2
```

移动文件需要两个参数，就像 cp 命令一样。但是，`mv` 不会复制和/或创建新文件，而是合并或修改我们作为参数提供的第二个文件。您不仅可以使用 `mv` 将文件移动到新文件夹，还可以使用 `mv `重命名文件或文件夹。例如，在下面的屏幕截图中，我们将文件“note2”重命名为“note3”。“note3” 现在将包含“note2” 的内容。 //重命名而不是新建复制

#### 确定文件类型film

经常具有误导性并经常让人们感到困惑的是，从文件中对其目的或内容做出假设。文件通常具有所谓的扩展名，以便更轻松地执行此作。例如，文本文件的扩展名通常为 “.txt”。但这不是必需的。

到目前为止，我们在示例中使用的文件还没有扩展名。如果不知道文件为什么在那里的上下文 -- 我们实际上并不知道它的用途。输入 `file` 命令。此命令采用一个参数。例如，我们将使用 `file` 来确认示例中的 “note” 文件是否确实是文本文件，例如 `file note`。

### 权限101

某些用户无法访问某些文件或文件夹。我们之前已经探索了一些命令，这些命令可用于确定我们拥有什么访问权限以及它将我们引导到哪里。

在前面的任务中，我们学习了如何通过 flags 和 switch 扩展命令的使用。以 `ls` 命令为例，该命令列出了当前目录的内容。使用 `-l `开关时，我们可以看到十列，如下面的屏幕截图所示。但是，我们只对前三列感兴趣：

```
tryhackme@linux2:~$ ls -lh
-rw-r--r-- 1 cmnatic cmnatic 0 Feb 19 10:37 file1
-rw-r--r-- 8 cmnatic cmnatic 0 Feb 19 10:37 file2
```

虽然令人生畏，但这三列对于确定文件或文件夹的某些特征以及我们是否可以访问它非常重要。文件或文件夹可以具有几个特征，这些特征决定了允许哪些作以及哪些用户或组能够执行给定的作 -- 例如：

- 读
- 写
- 执行 

**简述：用户和组之间的差异**

Linux 的伟大之处在于权限可以非常精细，虽然用户从技术上拥有一个文件，但如果已经设置了权限，那么一组用户也可以对完全相同的文件拥有相同或不同的权限集，而不会影响文件所有者本身。

让我们将其置于现实世界的背景中;运行 Web 服务器的系统用户必须具有读取和写入有效 Web 应用程序文件的权限。**但是，网络托管公司等公司将不得不允许他们的客户为他们的网站上传自己的文件，而无需成为网络服务器系统用户——这会损害所有其他客户的安全。**//网盘之类

我们将在下面学习在用户之间切换所需的命令。

**在用户之间切换**

借助 `su` 命令，在 Linux 安装的用户之间切换很容易。除非您是 root 用户（或通过 sudo 使用 root 权限），否则您需要了解两件事才能促进用户帐户的转换：

- 我们希望切换到的用户
- 用户的密码

`su` 命令需要几个可能与您相关的开关。例如，登录后执行命令或指定要使用的特定 shell。 我鼓励您阅读 su 的手册页 ``以了解更多信息。但是，我将介绍 `-l` 或 `--login` 开关。

简单地说，通过向 su 提供 `-l `开关 ``，我们启动了一个更类似于实际用户登录系统的 shell - 我们继承了新用户的更多属性，即环境变量等。 

使用 su 以交互方式切换到 user2

### 公共目录/etc

**/etc** 此根目录是系统上最重要的根目录之一。etc 文件夹（etcetera 的缩写）是存储作系统使用的系统文件的常用位置。

**“/var”** 目录（其中 “var” 是变量数据的缩写）是 Linux 安装中的主要根文件夹之一。此文件夹存储系统上运行的服务或应用程序经常访问或写入的数据。例如，来自正在运行的服务和应用程序的日志文件将写入此处 （**/var/log**），或者不一定与特定用户关联的其他数据（即数据库等）。

**/root**

与 **/home** 目录不同，**/root** 文件夹实际上是 “root” 系统用户的主目录。除了了解这是 “root” 用户的主目录之外，此文件夹没有其他任何内容。但是，值得一提的是，逻辑假设是默认情况下，该用户的数据将位于 “**/home/root**” 等目录中。 

**/tmp**

这是在 Linux 安装中找到的唯一根目录。/tmp 目录是“**temporary**”的缩写，是可变的，用于存储只需要访问一次或两次的数据。与计算机上的内存类似，一旦计算机重新启动，此文件夹的内容就会被清除。**在渗透测试中，对我们有用的是，默认情况下，任何用户都可以写入此文件夹。这意味着一旦我们可以访问一台机器，它就会成为存储枚举脚本等内容的好地方。**

### 总结

干得漂亮！这个房间的理论非常丰富，涵盖了相当多的基础知识，让您熟悉 Linux。快速回顾一下，这个房间教会了你：

- 如何使用 SSH 远程连接到 Linux 计算机
- 通过提供标志、开关以及了解每个命令的这些内容的位置来改进命令的使用（手册页）
- 您经常使用的其他命令来与文件系统及其内容进行交互
- 文件权限和切换用户的简要介绍
- Ubuntu Linux 安装上重要根目录的摘要段落，以及我们如何使用存储在这些根目录中的数据。

我鼓励您再经过这个房间一两次，以熟悉这些概念。毕竟，熟能生巧！



## PART3 目标

这个房间将展示一些您可能日常使用的有用实用程序和应用程序。您还将通过学习自动化、包管理和服务/应用程序日志记录来提高您的 Linux-fu 技能。 

### 终端文本编辑器

您可以使用一些选项，所有这些选项都具有各种友好性和实用性。这个任务将向你介绍 `nano`，但也将向你展示一个名为 `VIM` 的替代方案（TryHackMe 有一个专门的房间！

#### nano

Nano 很容易上手！要使用 nano 创建或编辑文件，我们只需使用 `nano filename` -- 将 “filename” 替换为您要编辑的文件的名称。

```
tryhackme@linux3:/tmp# nano myfile
  GNU nano 4.8                                             myfile                                                       

^G Get Help    ^O Write Out   ^W Where Is    ^K Cut Text    ^J Justify     ^C Cur Pos     M-U Undo       M-A Mark Text
^X Exit        ^R Read File   ^\ Replace     ^U Paste Text  ^T To Spell    ^_ Go To Line  M-E Redo       M-6 Copy Text
```

按下 Enter 键执行命令后，`nano` 将启动！我们可以开始输入或修改文本的地方。您可以使用 “up” 和 “down” 箭头键导航每一行，或使用键盘上的 “Enter” 键开始新行。

Nano 具有一些易于记忆的功能，并涵盖了您希望从文本编辑器中获得的最通用内容，包括：

- 搜索文本
- 复制和粘贴
- 跳转到行号
- 找出您所在的线路号

您可以通过按“**Ctrl**”键（在 Linux 上表示为 `^`） 和相应的字母来使用 nano 的这些功能。例如，要退出，我们需要按“**Ctrl**”和“**X**”退出 Nano。

#### VIM

VIM 是一个更高级的文本编辑器。虽然您不需要了解所有高级功能，但提及它对于增强您的 Linux 技能会很有帮助。

VIM 的一些好处，尽管需要更长的时间才能熟悉，包括：

- 可定制 - 您可以修改 键盘快捷键以供您选择
- 语法高亮显示 - 如果您正在编写或维护代码，这将非常有用，使其成为软件开发人员的热门选择
- VIM 适用于可能未安装 nano 的所有终端
- 有很多资源，例如[备忘单 ](https://vim.rtorr.com/)、教程和可供您使用的种类。

*以后再来补充*

### 常规/有用程序

#### 下载文件 （wget） w get

计算的一个非常基本的特性是传输文件的能力。例如，您可能想要下载程序、脚本甚至图片。值得庆幸的是，我们可以通过多种方式检索这些文件。

我们将介绍 `wget `的使用 . 此命令允许我们通过 HTTP 从 Web 下载文件 -- 就像您在浏览器中访问文件一样。我们只需要提供我们想要下载的资源的地址。例如，如果我想将一个名为“myfile.txt”的文件下载到我的计算机上，假设我知道它的 Web 地址 -- 它将如下所示：  **wget + 地址网址**

```
wget https://assets.tryhackme.com/additional/linux-fundamentals/part3/myfile.txt
```

#### 从主机传输文件 - SCP （SSH）

安全复制 （SCP）secure copy 就是这样 -- 一种安全复制文件的方法。与常规的 cp 命令不同，此命令允许您使用 SSH 协议在两台计算机之间传输文件，以提供身份验证和加密。

使用 SOURCE 和 DESTINATION 模型，SCP 允许您：

- 将文件和目录从您当前的系统复制到远程系统
- 从远程系统复制文件和目录到当前系统

提是我们知道您当前系统上的用户和远程系统上的用户的用户名和密码（**公钥和私钥**）。例如，让我们将示例文件从我们的机器复制到远程机器上，我已将其整齐地排列在下表中：

| **变量**                           | **价值**        |
| ---------------------------------- | --------------- |
| 远程系统的 IP 地址                 | 192.168.1.30    |
| 远程系统上的用户                   | ubuntu          |
| 本地系统上的文件名称               | important.txt   |
| 我们希望在远程系统上存储文件的名称 | transferred.txt |

有了这些信息，让我们编写我们的 `scp` 命令（记住 SCP 的格式只是 SOURCE 和 DESTINATION）

```
scp important.txt ubuntu@192.168.1.30:/home/ubuntu/transferred.txt
```

*即scp + 资源名字 + 资源地址*

上传的命令现在将如下所示： `scp ubuntu@192.168.1.30:/home/ubuntu/documents.txt notes.txt ` 

*即scp + 上传地址 + 资源地址*

#### 从主机提供文件 - WEB

Ubuntu 计算机预打包了 python3。Python 提供了一个名为 “HTTPServer” 的轻量级且易于使用的模块。此模块将您的计算机变成一个快速简便的 Web 服务器，您可以使用它来提供自己的文件，然后可以使用 `curl `和 `wget` 等命令由另一台计算机下载它们。 (**先打包之后才能下载**)

Python3 的 “HTTPServer” 将在您运行命令的目录中提供文件，但这可以通过提供手册页中的选项来更改。简**单来说，我们需要做的就是在终端运行 `python3 -m http.server` 来启动模块**！在下面的代码段中，我们从一个名为 “webserver” 的目录提供数据，该目录有一个名为 “file” 的目录。

```
tryhackme@linux3:/webserver# python3 -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```

现在，让我们使用 `wget `通过 10.10.190.194 地址和文件名下载文件。请记住，由于 python3 服务器运行的是端口 8000，因此您需要在 wget 命令中指定此端口。例如：

```
tryhackme@mymachine:~# wget http://10.10.190.194:8000/myfile
```

请注意，您需要打开一个新终端才能使用 `wget`，并保留已在其中启动 Python3 Web 服务器的终端。这是因为，一旦您启动 Python3 Web 服务器，它将在该终端中运行，直到您取消它。（**要开一个新终端**）

### 进程101

进程是计算机上运行的程序。它们由内核管理，其中每个进程都有一个与之关联的 ID，也称为其 PID。PID 将按流程开始的顺序递增。即第 60 个进程的 PID 为 60。

#### 查看进程ps

我们可以使用友好的 `ps` 命令来提供正在运行的进程列表作为用户的会话和一些其他信息，例如其状态代码、运行它的会话、它使用的 CPU 的使用时间以及正在执行的实际程序或命令的名称：![https://assets.tryhackme.com/additional/linux-fundamentals/part3/ps1.png](D:\Typora\保存文档\网络安全\assets\ps1.png)

请注意，在上面的屏幕截图中，第二个进程 ps 的 PID 为 204，然后在它下面的命令中，PID 随后递增到 205。

要查看其他用户运行的进程和不从会话运行的进程（即系统进程），我们需要为 `ps` 命令提供 **aux**，如下所示：`ps aux`

**另一个非常有用的命令是 top 命令;top 为您提供有关系统上运行的进程的实时统计信息，而不是一次性视图。这些统计信息将每 10 秒刷新一次，但当您使用箭头键浏览各个行时，这些统计信息也会刷新。另一个深入了解您的系统的好方法命令是通过 `top` 命令**       top命令

#### 管理进程

您可以发送终止进程的信号;**有多种类型的信号与 kernel 处理进程的 “干净” 程度有关**。要终止命令，我们可以使用适当命名的 `kill` 命令和我们希望终止的关联 PID。即，要终止 PID 1337，我们将使用 `kill 1337`。

以下是当进程被终止时我们可以发送到进程的一些信号：

- **SIGTERM** - 杀死进程，但允许它事先执行一些清理任务
- **SIGKILL** - 终止进程 - 事后不做任何清理
- **SIGSTOP** - 停止/暂停进程

#### **流程如何开始？**//重要

一个流程是怎么开始的？让我们从讨论命名空间开始。操作系统 （OS） 使用命名空间最终将计算机上的可用资源拆分给 （例如 CPU、RAM 和优先级） 进程。可以将其视为将计算机分成多个切片 - 类似于蛋糕。该 slice 中的进程将可以访问一定量的计算能力，但是，它只是每个进程实际可用的一小部分。

**命名空间对于安全性非常有用，因为它是将进程与另一个进程隔离的一种方式 —— 只有位于同一命名空间中的进程才能看到彼此。**

我们之前讨论过 PID 的工作原理，这就是它发挥作用的地方。ID 为 0 的进程是在系统引导时启动的进程。此进程是系统在 Ubuntu 上的 init，例如 **systemd**，它用于提供一种管理用户进程的方法，位于作系统和用户之间。 （pid0是系统启动进程）

例如，一旦系统启动并初始化，**systemd** 是最早启动的进程之一。我们想要启动的任何程序或软件都将作为所谓的 **systemd** 子进程启动。**这意味着它由 systemd 控制，但将作为自己的进程运行（尽管共享 systemd 的资源）以方便我们识别等**。

#### 在引导时启动进程/服务

某些应用程序可以在我们拥有的系统启动时启动。例如，Web 服务器、数据库服务器或文件传输服务器。该软件通常很关键，并且通常由管理员在系统启动期间告知启动。（**开机自启动**）

在此示例中，我们将告诉 apache Web 服务器手动启动 apache，然后告诉系统在启动时启动 apache2。 阿帕奇🤣

输入 `systemctl` 的使用 -- 此命令允许我们与 **systemd** 进程/守护进程进行交互。继续我们的示例，systemctl 是一个易于使用的命令，采用以下格式：`systemctl [option] [service]`

*即systemctl + 操作 + 服务对象*

例如，要告诉 apache 启动，我们将使用 `systemctl start apache2`。看起来很简单，对吧？与我们想停止 apache 相同，我们只需将 `[option]` 替换为 stop（而不是我们提供的 start）

我们可以用 `systemctl` 做四个选项：

- 开始start
- 停stop
- 使enable
- 禁用disable

#### Linux 中的后台和前台  简介

在这里，我们运行 `echo “Hi THM”` ，我们希望输出会像开始时一样返回给我们。但是在将 `&` 运算符添加到命令后，我们只得到了回声进程的 ID，而不是实际的输出 - 因为它在后台运行。![img](D:\Typora\保存文档\网络安全\assets\bg1.png)

这对于复制文件等命令非常有用，因为这意味着我们可以在后台运行命令并继续执行我们希望执行的任何进一步命令（无需等待文件复制先完成）

**我们可以在执行像脚本这样的事情时做完全相同的事情--而不是依赖&运算符--我们可以在键盘上使用 `Ctrl + Z` 来后台处理一个进程。这也是 “暂停” 脚本或命令执行的有效方法，如下例所示：**![img](D:\Typora\保存文档\网络安全\assets\bg2.png)

此脚本将不断重复 “This will keep on looping until I stop！”，直到我停止或暂停该进程。通过使用 `Ctrl + Z`（如 **T^Z** 所示）。现在我们的终端不再充满消息 —— 直到我们将其前台化，我们将在下面讨论。*即ctrl + z = 后台化*

#### 前台化进程

当我们的进程使用 `Ctrl + Z` 或 `&` 运算符进行后台处理后，我们可以使用 `fg` 将其恢复到焦点，如下所示，我们可以看到 `fg` 命令正在终端上重新使用后台进程，脚本的输出现在返回到我们这里。

### 维护系统/自动化

用户可能希望将某个作或任务安排在系统引导后进行。例如，运行命令、备份文件或启动您最喜欢的程序，例如 Spotify 或 Google Chrome。

我们将讨论 `cron` 进程，但更具体地说，我们如何通过使用 `crontabs` 与它交互 .Crontab 是在启动期间启动的进程之一，它负责促进和管理 cron 作业。

![img](D:\Typora\保存文档\网络安全\assets\cron1.png)

crontab 只是一个特殊的文件，其格式可被 `cron` 进程识别，以逐步执行每一行。Crontabs 需要 6 个特定值：

| 价值 | 描述                   |
| ---- | ---------------------- |
| MIN  | 执行时间               |
| HOUR | 执行时间               |
| DOM  | 在每月的哪一天执行     |
| MON  | 在一年中的哪个月份执行 |
| DOW  | 在一周中的哪一天执行   |
| CMD  | 将要执行的实际命令。   |

让我们使用备份文件的示例。您可能希望每 12 小时备份一次 “cmnatic” 的 “Documents”。我们将使用以下格式：

```
0 */12 * * * cp -R /home/cmnatic/Documents /var/backups/
```

0 */12 * * * cp 地址

crontabs 的一个有趣功能是它们还支持通配符或星号 （`*`）。如果我们不想为该特定字段提供值，即我们不关心它执行的月份、日期或年份 —— 只关心它每 12 小时执行一次，我们只只需放置一个星号。

一开始这可能会令人困惑，这就是为什么有一些很棒的资源，例如在线“[Crontab 生成器 ](https://crontab-generator.org/)”，它允许您使用友好的应用程序为您生成格式！以及网站“[Cron Guru](https://crontab.guru/)”！

可以使用 `crontab -e 编辑 crontab`，您可以在其中选择编辑器（例如 Nano）来编辑 crontab。

![img](D:\Typora\保存文档\网络安全\assets\cron2.png)

### 维护系统/软件包管理  apt命令

**介绍软件包和软件存储库** 

当开发人员希望向社区提交软件时，他们会将其提交到 “apt” 存储库。如果获得批准，他们的程序和工具将被发布到上面。 Linux 的两个最值得注意的功能在这里得到了体现：**用户可访问性和开源工具的优点。**

**虽然作系统供应商将维护他们自己的存储库，但您也可以将社区存储库添加到您的列表中！这允许您扩展作系统的功能。可以使用 `add-apt-repository` 命令或列出其他提供商来添加其他存储库！例如，一些供应商将拥有更靠近其地理位置的存储库。**

在 Ubuntu 20.04 Linux 计算机上使用 `ls `命令时，这些文件将用作网关/注册表。 ![img](D:\Typora\保存文档\网络安全\assets\apt1.png)



**管理您的仓库 （添加和删除）**

通常我们使用 apt 命令将软件安装到我们的 Ubuntu 系统上。`apt` 命令是软件包管理软件的一部分，也名为 apt。Apt 包含一整套工具，允许我们管理软件的包和源代码，并同时安装或删除软件。

添加仓库的一种方法是使用我们上面演示的 `add-apt-repository` 命令，但我们将 逐步手动添加和删除仓库 。虽然你可以通过使用 **dpkg** 等软件包安装程序来安装软件 ``，**但 apt 的好处意味着每当我们更新系统时 -- 包含我们添加的软件的仓库也会被检查是否有更新。** 

在此示例中，我们将文本编辑器 Sublime Text 作为存储库添加到我们的 Ubuntu 计算机中，因为它不是默认 Ubuntu 存储库的一部分。**添加软件时，我们下载的内容的完整性通过使用所谓的 GPG （Gnu Privacy Guard） 密钥来保证。这些密钥本质上是开发人员的安全检查，说“这是我们的软件”。**如果密钥与您的系统信任的密钥和开发人员使用的密钥不匹配，则不会下载该软件。

因此，首先，我们需要为 Sublime Text 3 的开发人员添加 GPG 密钥。（请注意，TryHackMe 实例无法访问 Internet，因此我们不希望您将其添加到您部署的计算机中，因为它会失败。

**1.** 让我们下载 GPG 密钥并使用 apt-key 来信任它：  `wget -qO - https://download.sublimetext.com/sublimehq-pub.gpg | sudo apt-key add -`     -qO（大写）下载        sudo apt-key add -    信任加入

**2.** 现在我们已经将此密钥添加到我们的受信任列表中，我们现在可以将 Sublime Text 3 的存储库添加到我们的 apt 源列表中。一个好的做法是，**为我们添加的每个不同的社区/第三方存储库提供一个单独的文件。**

**2.1.** 让我们在 **/etc/apt/sources.list.d** 中创建一个名为 **sublime-text.list** 的文件，并输入仓库信息，如下所示：

![img](D:\Typora\保存文档\网络安全\assets\sources1.png)

**2.2.** 现在使用 Nano 或您选择的文本编辑器将 Sublime Text 3 仓库（网页地址）添加并保存到这个新创建的文件中：

![img](D:\Typora\保存文档\网络安全\assets\sources2.png)

**2.3.** 添加此条目后，我们需要更新 apt 以识别此新条目 -- 这是使用 `apt update` 命令完成的

**2.4.** 成功更新后，我们现在可以使用 `apt install sublime-text` 继续安装我们信任并添加到 apt 的软件 

删除包就像倒车一样简单。1.此过程通过使用命令 `add-apt-repository --remove ppa:PPA_Name/ppa` 或2.手动删除我们之前添加到的文件来完成。删除后，我们就可以只使用 `apt remove [software-name-here]` `apt remove sublime-text`

### 维护系统/日志

我们在 Linux 基础知识 第 1 部分 中简要介绍了日志文件以及它们可以在哪里找到。但是，让我们快速回顾一下。这些文件和文件夹位于 /var/log 目录中，包含系统上运行的应用程序和服务的日志记录信息。作系统 （OS） 已经非常擅长在称为 “轮换” 的过程中自动管理这些日志。

## LAN简介 Local Area Network

### 局域网 （LAN） 拓扑

多年来，已经对各种网络设计进行了实验和实施。对于网络，当我们提到术语 “拓扑” 时，我们实际上指的是手头网络的设计或外观。下面我们来讨论一下这些拓扑的优缺点。

**星型拓扑**的主要前提是设备通过中央网络设备（如交换机或集线器）单独连接。这种拓扑是当今最常见的拓扑，因为它具有可靠性和可扩展性 - 尽管成本高昂。

由于此拓扑需要更多的布线和购买专用网络设备，因此它比任何其他拓扑都更昂贵。然而，尽管成本增加，但这确实提供了一些显着的优势。例如，这种拓扑本质上更具可扩展性，这意味着随着网络需求的增加，很容易添加更多设备。

遗憾的是，网络规模越大，保持网络正常运行所需的维护就越多。这种对维护的依赖增加也会使故障排除变得更加困难。此外，星形拓扑结构仍然容易出现故障 - 尽管有所减少。例如，如果连接设备的集中式硬件发生故障，这些设备将无法再发送或接收数据。值得庆幸的是，这些集中式硬件设备通常很强大。

**总线拓扑**

这种类型的连接依赖于称为主干电缆的单个连接。这种类型的拓扑类似于树的叶子，因为设备（叶子）从此电缆上的树枝所在的位置开始。

由于发往每个设备的所有数据都沿着同一根电缆传输，因此如果拓扑中的设备同时请求数据，则很快就会变得缓慢和瓶颈。这种瓶颈还会导致非常困难的故障排除，因为很快就会变得难以识别哪个设备遇到了问题，所有数据都沿着同一路径传输。

然而，话虽如此，总线拓扑是更容易设置且更具成本效益的拓扑之一，因为它们需要花费，例如用于连接这些设备的布线或专用网络设备。

最后，总线拓扑的另一个缺点是，在发生故障时几乎没有冗余。这个缺点是因为沿主干电缆存在单点故障。如果此电缆断开，设备将无法再沿总线接收或传输数据。

![img](D:\Typora\保存文档\网络安全\assets\27e9ff166d2d4ad5436e27c8c9b62e6d.png)



**环形拓扑**（也称为令牌拓扑）具有一些相似之处。计算机等设备直接相互连接以形成一个环路，这意味着几乎不需要布线，并且对专用硬件（例如在星形拓扑中）的依赖较小。

环形拓扑的工作原理是跨循环发送数据，直到数据到达目标设备，并使用循环中的其他设备转发数据。有趣的是，如果设备没有要发送的数据，则它只会从此拓扑中的另一台设备发送接收到的数据。如果设备恰好有数据要发送，它将先发送自己的数据，然后再从另一台设备发送数据。

由于数据只有一个方向可以穿过此拓扑，因此对出现的任何故障进行故障排除相当容易。然而，这是一把双刃剑，因为它不是一种.有效的数据通过网络传输的方式，因为它可能必须先访问许多多个设备才能到达预期的设备。

最后，环形拓扑不太容易出现瓶颈，例如在总线拓扑中，因为大量流量不会在任何时候通过网络传输。但是，这种拓扑的设计确实意味着诸如电缆切断或设备损坏等故障将导致整个网络中断。

![https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/4cea7a4b48eacbd4db0b0d5e32068596.png](D:\Typora\保存文档\网络安全\assets\4cea7a4b48eacbd4db0b0d5e32068596.png)

交换机是网络中的专用设备，旨在聚合多个其他设备，例如计算机、打印机或任何其他使用以太网的支持联网的设备。这些不同的设备插入交换机的端口。交换机通常位于较大的网络中，例如企业、学校或类似规模的网络，其中有许多设备可以连接到网络。交换机可以通过 4、8、16、24、32 和 64 端口来连接大量设备，以便设备插入。

#### 交换机

交换机比较小的同类产品（集线器/中继器）效率更高。交换机跟踪连接到哪个端口的设备。这样，当他们收到数据包时，它不会像集线器那样将该数据包重复到每个端口，而是将其发送到预期目标，从而减少网络流量。

![img](D:\Typora\保存文档\网络安全\assets\2504bf9d718556c764c28843f43febe0.png)

交换机和路由器都可以相互连接。这样做的能力通过为数据添加多个路径来增加网络的冗余（可靠性）。如果一条路径出现故障，则可以使用另一条路径。虽然这可能会降低网络的整体性能，因为数据包必须花费更长的时间来传输，但没有停机时间 - 考虑到替代方案，这是一个很小的代价。

#### 路由器//导航

路由器的工作是连接网络并在它们之间传递数据。它通过使用路由来实现这一点（因此得名 router！

路由是给跨网络传输数据的过程的标签。路由涉及在网络之间创建路径，以便成功传送此数据。

当设备通过许多路径连接时，路由非常有用，如下面的示例图所示。

![img](D:\Typora\保存文档\网络安全\assets\e83d39192c6a3e8168f842d9a680a7c3.png)

### 子网划分

正如我们之前在整个模块中讨论的那样，网络可以找到各种形状和大小 - 从小到大。子网划分是指在自身内部将网络拆分为更小的微型网络。把它想象成为你的朋友切蛋糕。只有一定数量的蛋糕可以吃，但每个人都想分一杯羹。**子网划分就是你决定谁得到什么份额，并保留这个比喻蛋糕的这样一块。**

以一家企业为例;您将拥有不同的部门，例如：

- 会计学
- 金融
- 人力资源

![img](D:\Typora\保存文档\网络安全\assets\dfdda87fb215cd723555bde32345e05e.png)

正如我们所记得的，IP 地址由四个称为八位字节的部分组成。子网掩码也是如此，它也表示为 4 个字节 （32 位） 的数字，范围从 0 到 255 （0-255）。

子网以三种不同的方式使用 IP 地址：

- 确定网络地址
- 确定主机地址
- 确定默认网关

让我们将这三个部分分为下表以了解它们的用途：

| **类型** | **目的**                                                     | **解释**                                                     | **例**        |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------- |
| 网络地址 | 此地址标识实际网络的起点，并用于标识网络的存在。             | 例如，IP 地址为 192.168.1.100 的设备将位于由 192.168.1.0 标识的网络上 | 192.168.1.0   |
| 主机地址 | 此处的 IP 地址用于标识子网上的设备                           | 例如，设备的网络地址为 192.168.1.1                           | 192.168.1.100 |
| 默认网关 | 默认网关地址是分配给网络上设备的特殊地址，该地址能够将信息发送到另一个网络 | 任何需要发送到不在同一网络上的设备（即不在 192.168.1.0 上）的数据都将被发送到此设备。这些设备可以使用任何主机地址，但通常使用网络中的第一个或最后一个主机地址（.1 或 .254） | 192.168.1.254 |

稍后我们将继续探讨子网划分如何提供这些好处;但是，就目前而言，我们需要了解的只是它的安全元素。让我们以街上的典型咖啡馆为例。这家咖啡馆将有两个网络：

1. 一个用于员工、收银机和设施的其他设备
2. 一个供公众用作热点

**子网划分允许您将这两个用例彼此分开，同时获得连接到更大网络（如 Internet）的好处。**



### ARP  A **ddress** **R**esolution **P**rotocol 

回顾我们之前的任务，设备可以有两个标识符：MAC 地址和 IP 地址，简称 A **ddress** **R**esolution **P**rotocol 或简称 **ARP**，是负责允许设备在网络上识别自己的技术。

简单地说，**ARP 允许设备将其 MAC 地址与网络上的 IP 地址相关联。网络上的每台设备都将保留与其他设备关联的 MAC 地址的日志。****作用**：将 **IP 地址** 解析为对应的 **MAC 地址**（物理地址）。

**ARP 是如何工作的？**

网络中的每个设备都有一个用于存储信息的账本，称为缓存。在 **ARP** 上下文中，此缓存存储网络上其他设备的标识符。

为了将这两个标识符（IP 地址和 MAC 地址）映射在一起，ARP 发送两种类型的消息：

1. **ARP （ARP）请求**
2. **ARP （ARP）答**

发送 **ARP 请求**时，会在网络上向其他设备广播一条消息，询问“拥有此 IP 地址的 mac 地址是什么？当其他设备收到该消息时，它们只有在拥有该 IP 地址时才会响应，并将发送包含其 MAC 地址的 **ARP 回复** 。请求设备现在可以记住此映射并将其存储在其 **ARP 缓存**中以备将来使用。

![img](D:\Typora\保存文档\网络安全\assets\2107060a6e1df30659654335b878e91a.png)

### DHCP 动态主机设置协议

- **作用**：自动为网络中的设备分配 **IP 地址、子网掩码、默认网关、DNS 服务器** 等网络配置。

IP 地址可以**通过物理方式输入设备来手动分配**，也可以通过使用 **DHCP** （**D**ynamic **H**ost **C**onfiguration **P**rotocol） 服务器自动分配。当设备连接到网络时，如果尚未手动为其分配 IP 地址，它会发出请求 （DHCP Discover） 以查看网络上是否有任何 DHCP 服务器。然后，DHCP 服务器会回复设备可以使用的 IP 地址 （DHCP Offer）。然后，设备发送回复，确认它需要提供的 IP 地址（DHCP 请求），最后，DHCP 服务器发送回复，确认已完成此作，设备可以开始使用 IP 地址 （DHCP ACK）。

![img](D:\Typora\保存文档\网络安全\assets\0514189b8424bb6493f7b427b40425e2.png)



## OSI 模型

**OSI** 模型（或 **O**pen **S**ystems **I**nterconnection 模型）是网络中使用的基本模型。 这个关键模型提供了一个框架，规定了所有联网设备将如何发送、接收和解释数据。

OSI 模型的主要优点之一是，设备在与其他设备通信时可以在网络上具有不同的功能和设计。通过遵循 OSI 模型一致性的网络发送的数据可以被其他设备理解。

OSI 模型由七层组成，如下图所示。每个层都有一组不同的职责，从第 7 层到第 1 层排列。

在数据经过的每一层，都会发生特定的流程，并将信息添加到这些数据中，这就是我们将在本次会议中即将讨论的任务中讨论的内容。但是，现在，我们只需要了解此过程称为**封装encapsulation** 以及下图中 OSI 模型的外观：

![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/6d17472b87f8792dadde3bb06aa1fdaa.svg)

### 1.物理层 physical

此层是最容易掌握的层之一。简单地说，此层引用网络中使用的硬件的物理组件，是您将找到的最低层。设备使用电信号在二进制编号系统（1 和 0）中相互传输数据。

例如，连接设备的以太网ethernet cables电缆，如下图所示

### 2.datalink 数据链接

**数据链路层侧重于传输的物理寻址**。它从网络层接收数据包（包括远程计算机的 IP 地址），并添加接收端点的物理 **MAC**（媒体访问控制）地址。每台支持网络的计算机内部都有一个 **N**etwork **I**nterface card（**NIC），** 它带有一个唯一的 MAC 地址来识别它。

MAC 地址由制造商设置并实际烧录到卡中;它们无法更改 - 尽管它们可以被欺骗。当信息通过网络发送时，它实际上是用于标识信息的确切发送位置的物理地址。

此外，**数据链路层的工作还包括以适合传输的格式呈现数据**。

### 3.network 网络

OSI 模型的第三层（网络层）**是路由和重新组装数据的魔力发生的地方**（从这些小块到更大的块）。首先，路由只是确定这些数据块应发送到的最佳路径。

虽然这一层的一些协议准确地确定了数据到达设备的 “最佳” 路径，**但我们只能在网络模块的这个阶段知道它们的存在**。简而言之，这些协议包括 **OSPF** （**O**pen **Shortest** **P**ath **F**irst） 和 **RIP** （**R**outing **I**nformation **P**rotocol）。决定采用哪种路线的因素由以下因素决定：

- 哪条路最短？即，数据包需要传输的设备数量最少。
- 什么路径最可靠？即，数据包之前是否在该路径上丢失过？
- 哪条路径的物理连接速度更快？即，一条路径是使用铜缆连接（较慢）还是光纤（相当快）？



在这一层**，一切都通过 IP 地址处理，例如** 192.168.1.100。能够使用 IP 地址传输数据包的设备（例如路由器）称为第 3 层设备，因为它们能够在 OSI 模型的第三层工作。

![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/893620a3545775f0fbbd75ea4bc4a946.svg)

### 4.transport 运输层

OSI 模型的第 4 层在通过网络传输数据方面起着至关重要的作用，可能有点难以掌握。在设备之间发送数据时，它遵循两种不同的协议之一，这些协议是根据几个因素决定的：

- TCP 协议
- UDP 协议

#### TCP协议

让我们从 TCP 开始。**T**ransmission **C**ontrol **P**rotocol （**TCP）。** 顾名思义，该协议在设计时考虑了可靠性和保证。**此协议在两个设备之间保留一个持续连接，用于发送和接收数据所需的时间。**

不仅如此，TCP 还将错误检查纳入其设计中。错误检查是 TCP 如何保证从会话层（第 5 层）中的小块发送的数据随后以相同的顺序接收和重组。

让我们在下表中总结 TCP 的优缺点：

| **TCP 的优点 **                          | **TCP 的缺点 **                                              |
| ---------------------------------------- | ------------------------------------------------------------ |
| 保证数据的准确性。                       | 需要在两个设备之间建立可靠的连接。如果未收到一小块数据，则无法使用整个数据块。 |
| 能够同步两个设备，以防止彼此被数据淹没。 | 慢速连接可能会给另一台设备带来瓶颈，因为连接将始终在接收计算机上保留。 |
| 执行更多的过程以实现可靠性。             | TCP 比 UDP 慢得多，因为使用此协议的设备必须完成更多工作。    |

**优点：可靠，准确，同步设备**

**缺点：需要两个设备可靠连接，如小块错误则一大块无法访问；速度慢，占用会大一点**

TCP 用于文件共享、Internet 浏览或发送电子邮件等情况。**这种用法是因为这些服务要求数据准确和完整（拥有半个文件不好！**

**在下图中，我们可以看到猫的图片是如何从 “webserver” 分解成小块数据（称为数据包）的**，其中 “computer” 将猫的图片重新构建为正确的顺序。

![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/d47215ad75f503af0b06dacca9ebace6.svg)

#### udp协议

现在让我们进入 **U**ser **D**atagram **P**rotocol（或简称 **U****D****P** ）。该协议不如它的兄弟 TCP 协议先进。它没有 TCP 提供的许多功能，例如错误检查和可靠性。事实上**，通过 UDP 发送的任何数据都会发送到计算机，无论它是否到达那里**。**两个设备之间没有同步或保证;只是希望最好**，手指交叉。

虽然这听起来很不利，但它确实有其优点，我们将在下表中进行布局：

| **UDP 的优势**                                               | **UDP 的缺点**                                     |
| ------------------------------------------------------------ | -------------------------------------------------- |
| UDP 比 TCP 快得多。                                          | UDP 不关心是否收到数据。                           |
| UDP 让应用程序层（用户软件）决定是否可以控制数据包的发送速度。 | 从这个意义上说，它对软件开发人员来说是相当灵活的。 |
| UDP 不会像 TCP 那样在设备上保留连续连接。                    | 这意味**着不稳定的连接会给用户带来糟糕的体验。**   |

![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/3259184a7fd3dafed265974c31fc8c46.svg)

UDP 在发送小块数据的情况下非常有用。例如，用于发现设备的协议（我们在 [2 号房间 - LAN 简介](https://tryhackme.com/room/introtolan)中讨论的 *ARP* 和 *DHCP*）**或更大的文件，例如视频流（如果视频的某些部分被像素化，也可以）。像素只是丢失的数据片段！**

### 5.session  会话层

一旦数**据从表示层（第 6 层）**正确转换或格式化，**会话层（第 5 层）**将开始创建和维护与数据目标的其他计算机的连接。建立连接后，将创建一个会话。当此连接处于活动状态时，会话也处于活动状态。

**会话层还负责关闭连接**（如果连接有一段时间未使用或丢失）。此外，**会话*可以* 包含“检查点”**，如果数据丢失，则只需要发送最新的数据 ，从而节省带宽。 

**值得注意的是，会话是唯一的，这意味着数据不能在不同的会话之间传输，而实际上只能在每个会话之间传输。**

这个建立会话的技术叫做session

### 6.presentation  表现层

OSI 模型的第 6 层是开始**进行标准化的层**。**由于软件开发人员可以以不同的方式开发任何软件，例如电子邮件客户端，因此无论软件如何工作，数据仍然需要以相同的方式处理。**

该层充当**数据进出应用程序层（第 7 层）的转换器**。接收计算机还将理解以一种格式发送到计算机的数据，这些数据以另一种格式发送给计算机。**例如，当您发送电子邮件时，其他用户可能有其他电子邮件客户端发送给您，但电子邮件的内容仍需要显示相同的内容。**

**数据加密（如访问安全站点时的 HTTPS）等安全功能位于此层。**

### 7.application 应用层

OSI 模型的应用层是您最熟悉的层。**之所以如此熟悉，是因为应用程序层是协议和规则所在的层 ** **，用于确定用户应如何与发送或接收的数据进行交互。**

常应用程序（如电子邮件客户端、浏览器或文件服务器浏览软件（如 FileZilla）为用户提供了一个友好的 **G** **实时**  **G**raphical **U**ser **I**nterface 用户界面 （**GUI），** 以便与发送或接收的数据进行交互。其他协议包括 **DNS** （**D**omain **N**ame **S**ystem），这是网站地址转换为 IP 地址的方式。

**DNS（Domain Name System，域名系统）** 是互联网中用于将 **域名（如 [www.example.com](http://www.example.com/)）解析为 IP 地址（如 192.0.2.1）** 的核心协议。

#### **DNS 的工作原理**

1. **用户输入域名**（如 `www.example.com`）后，设备会发起 DNS 查询。
2. **递归查询**（由本地 DNS 服务器完成）：
   - 先查询本地缓存 → 若无结果，向根域名服务器询问 `.com` 的地址。
   - 接着询问 `.com` 服务器，获取 `example.com` 的权威服务器地址。
   - 最终从权威服务器获取 `www.example.com` 的 IP。
3. **返回结果**：本地 DNS 服务器将 IP 返回给用户设备，并缓存结果。



## 数据包和框架/帧  Packets and Frames 

### 1.什么是数据包和帧？

数据包和帧是**小块数据**，当它们组合在一起时，会形成较大的信息或消息。但是，**它们在 OSI 模型中是两个不同的东西。帧位于第 2 层 - 数据链路层，这意味着没有 IP 地址等信息。**将此视为将信封放入信封中并将其寄走。第一个信封将是您邮寄的数据包，但一旦打开，其中的信封仍然存在并包含数据（这是一个框架）。

这个过程称为封装，我们在 [3 号房间中讨论过：OSI 模型 ](https://tryhackme.com/room/osimodelzi)。在这个阶段，**可以安全地假设当我们谈论任何 IP 地址时，我们谈论的是数据包。当封装信息被剥离时，我们谈论的是框架本身。**

数据包是在联网设备之间传输数据的一种有效方式，例如任务 1 中介绍的设备。由于这些数据是小块交换的**，因此与一次发送大消息相比，网络中出现瓶颈的可能性更小。**

例如，从网站加载图像时，此图像不会作为一个整体发送到您的计算机，而是在您的计算机上重建的小块。以下图为例来说明这个过程。猫咪的照片被分成三个包，到达计算机后被重建，形成最终的图像。

**数据包具有不同的结构，具体取决于要发送的数据包类型**。正如我们接下来将要讨论的那样，网络充满了标准和协议，它们充当了一组规则，用于定义如何在设备上处理数据包。互联网上连接了数十亿台设备，如果没有标准化，事情可能会很快崩溃。

让我们继续我们的 Internet 协议示例。使用此协议的数据包将具有一组标头，其中包含通过网络发送的数据的附加信息。

一些值得注意的标头包括：

| **头**           | **描述**                                                     |
| ---------------- | ------------------------------------------------------------ |
| 生存时间livetime | 此字段为数据包设置一个到期计时器，如果它从未设法到达主机或逃逸，则不会阻塞您的网络！ |
| 校验和Checksum   | 此字段为 TCP/IP 等协议提供完整性检查。如果更改了任何数据，此值将与预期值不同，因此会损坏。 |
| 源地址           | **发送 数据包**的设备的 IP 地址，以便数据知道要**返回到**何处。 |
| 目标地址         | 数据包发送到的设备的 IP 地址，以便数据知道下一步要去哪里。   |



### 2.TCP/IP三次握手  也就是小林coding介绍的

#### **TCP**/**IP** （或 简称 **T**ransmission **C**ontrol **P**rotocol）是网络中使用的另一种规则。   **//这是一个不同于OSI的新模型**

到目前为止，该协议与我们之前在本模块的 3 号房间中讨论的 OSI 模型非常相似。TCP/IP 协议由四层组成，可以说只是 OSI 模型的概括版本。这些层是：

- 应用
- 运输
- 互联网 网络层
- 网络接口

与 OSI 模型的工作方式非常相似，**当数据（或数据包）遍历 TCP 模型时，信息会添加到 TCP 模型的每一层**。您可能还记得，这个过程被称为 encapsulation - 这个过程的反面是 decapsulation**。解包**

TCP 的一个定义特征是它是 **基于连接的** ，这意味着 TCP 必须在发送数据之前在客户端和充当服务器的 设备之间建立连接 。 

因此，**TCP 保证发送的任何数据都将在另一端接收**。这个过程被称为 三次握手，我们稍后会讨论。 

TCP 数据包包含从封装添加的称为报头的信息的各个部分。让我们解释下表中的一些关键标头：

| **头**                         | **描述**                                                     |
| ------------------------------ | ------------------------------------------------------------ |
| 源端口                         | 此值是发送方打开的用于发送 TCP 数据包的端口。此值是随机选择的（从当时尚未使用的 0-65535 端口中）。 |
| 目标端口                       | 此值是应用程序或服务在远程主机（接收数据的主机）上运行的端口号;例如，在端口 80 上运行的 Web 服务器。与源端口不同，此值不是随机选择的。 |
| 源 IP                          | 这是发送数据包的设备的 IP 地址。                             |
| 目标 IP                        | 这是数据包的目标设备的 IP 地址。                             |
| 序列号                         | **当连接发生时，传输的第一条数据被赋予一个随机数。我们将在后面更深入地解释这一点。** |
| 鸣谢编号Acknowledgement Number | 为一条数据指定序列号后，下一条数据的编号将具有序列号 + 1。我们还将进一步更深入地解释这一点。//和pid类似 |
| 校验和Checksum                 | 此值是提供 TCP 完整性的原因。在记住输出的地方进行数学计算。当接收设备执行数学 计算时，如果输出与发送的内容不同，则数据必须损坏。 |
| 数据                           | 此标头是存储数据（即正在传输的文件的字节）的位置。           |
| 旗flag                         | **此标头确定任一设备在握手过程中应如何处理数据包（黑这里）**。特定的标志将决定特定的行为，这就是我们将在下面解释的内容。 |

接下来，我们将继续讨论 *三方握手 -* 该术语用于在两个设备之间建立连接的过程。 三方握手使用一些特殊消息进行通信 - 下表突出显示了主要消息：

| **步** | **消息**               | **描述**                                                     |
| ------ | ---------------------- | ------------------------------------------------------------ |
| 1      | SYN**Synchronize**     | SYN 消息是客户端在握手期间发送的初始数据包。此数据包用于启动连接并将两个设备同步在一起（我们稍后将进一步解释）。/**/发起连接** |
| 2      | SYN/ACK**Acknowledge** | 此数据包由接收设备（服务器）发送，以确认来自客户端的同步尝试。**//确认链接** |
| 3      | ACK**Acknowledge**     | 客户端或服务器可以使用确认数据包来确认已成功接收一系列消息/数据包。 |
| 4      | DATA                   | 建立连接后，数据（例如文件的字节）将通过 “DATA” 消息发送。   |
| 5      | FIN**Finish**          | 此数据包用于在连接完成后*干净（正确）* 关闭连接。            |
| #      | RST**Reset**           | 此数据包会突然结束所有通信。这是最后的手段，表明在此过程中存在一些问题。例如，如果服务或应用程序无法正常工作，或者系统存在资源不足等故障。//强制结束 |

| **PSH** | **Push**   | 要求接收方立即处理数据，而不是缓存（如 HTTP 请求）//如传输github | 实时性要求高的应用（如 SSH） |
| ------- | ---------- | ------------------------------------------------------------ | ---------------------------- |
| **URG** | **Urgent** | 标记紧急数据（很少使用）                                     | 几乎不用                     |

*这些都是flag里的头*

![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/67dc0504ffa42cac0579cfeb64227ccb.svg)

**任何发送的数据都会被赋予一个随机数字序列，并使用此数字序列并以 1 为增量进行重建。两台计算机必须就相同的编号规则达成一致，才能以正确的顺序发送数据。此顺序分三个步骤达成一致：**

1. SYN - 客户端：这是我的初始序列号 （ISN），用于 **SYN**chronise （0）
2. SYN/ACK - 服务器：这是我用 （5,000） 记录 **SYN** 的初始序列号  Initial Sequence Number （ISN），我 **现在确认**您的初始编号序列 （0）
3. 确认 - 客户：我**确认**您的初始序列号 （ISN） 为 （5,000），下面是我的 ISN+1 （0 + 1） 的一些数据

**//每发一次请求，序列加一**

| **装置**          | **初始编号序列 （ISN）	 ** | **最终编号序列	 ** |
| ----------------- | ----------------------------- | --------------------- |
| 客户端 （发件人） | 0                             | 0 + 1 = 1             |
| 客户端 （发件人） | 1                             | 1 + 1 = 2             |
| 客户端 （发件人） | 2                             | 2 + 1 = 3             |

#### **TCP 协议关闭连接：**

让我们快速解释一下 TCP 关闭连接背后的过程**。首先， 一旦设备确定另一台设备已成功接收所有数据，TCP 将关闭连接。**

由于 TCP 会在设备上保留系统资源，因此最佳做法是尽快关闭 TCP 连接。

要启动关闭 TCP 连接，**设备将向另一台设备发送 “FIN” 数据包**。当然，使用 TCP 时，另一台设备也必须确认此数据包。![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/d29463eda80fa9e4cbe78b16aa5d9f87.svg)

即使发送了fin，fin也双向。也要发送ack才能结束。**每一步之后都要回复收到**



### 3.UDP/IP协议

**U**ser **D**atagram **P**rotocol （**UDP**） 是另一种用于在设备之间传输数据的协议。与其兄弟 TCP 不同，UDP 是一种 **无 状态 ** **stateless**协议，不需要两个设备之间持续连接即可发送数据。例如，不会发生 Three-way hand shake，两个设备之间也没有任何同步。

回想一下 3 号房间中对这两个协议所做的一些比较：“OSI 模型”。也就是说，UDP 用于应用程序可以容忍数据丢失的情况（例如视频流或语音聊天）或不稳定的连接不是最终结果的情况。下表比较了 UDP 的优缺点：

UDP 数据包比 TCP 数据包简单得多，并且标头更少。但是，这两种协议共享一些标准标头，下表中对此进行了注释：

| **页眉**                     | **描述**                                                     |
| ---------------------------- | ------------------------------------------------------------ |
| 生存时间 time to live（TTL） | 此字段为数据包设置到期计时器，因此如果数据包从未成功到达主机或逃逸，它不会阻塞您的网络！ |
| 源地址                       | 发送数据包的设备的 IP 地址，以便数据知道要返回到何处。       |
| 目标地址                     | 数据包发送到的设备的 IP 地址，以便数据知道下一步要去哪里。   |
| 源端口                       | 此值是发送方打开的端口，用于发送 UDP 数据包。此值是随机选择的（从当时尚未使用的 0-65535 端口中）。 |
| 目标端口                     | 此值是应用程序或服务在远程主机（接收数据的主机）上运行的端口号;例如，在端口 80 上运行的 Web 服务器。与源端口不同，此值不是随机选择的。 |
| 数据                         | 此标头是存储数据（即正在传输的文件的字节）的位置。           |

我们应该记得 UDP 是**无状态**的。连接期间不会发送确认。

![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/53d459ccda57e5fdea0dafe7e64ffe7c.svg)

### 4.port 101 端口101

也许正如他们的名字一样，**端口是可以交换数据的重要点**。想想港口和港口。**希望停靠港口的船舶必须前往与船上的尺寸和设施相适应的港口。当船只排队时，它将连接到港口的港口 。例如，邮轮不能停靠在为渔船建造的港口，反之亦然。**

由于端口的范围可以在 **0 到 65535** 之间的任何位置，因此很快就会忘记哪个应用程序正在使用哪个端口。繁忙的港口一片混乱！值得庆幸的是，**我们将应用程序、软件和行为与一组标准规则相关联。例如，通过强制通过端口 80 发送任何 Web 浏览器数据，软件开发人员可以设计一个 Web 浏览器（如 Google Chrome 或 Firefox）来以相同的方式解释数据。**

虽然 Web 数据的标准规则是 *端口 80*，但已为其他一些协议分配了标准规则。**介于 0 和 1024 （1,024） 之间的 任何端口都称为公共端口。  让我们在下面探索一些其他协议：**

| **协议**                                                     | **端口号** | **描述**                                                     |
| ------------------------------------------------------------ | ---------- | ------------------------------------------------------------ |
| **F**ile **T**ransfer **P**rotocol （**FTP**）               | 21         | 此协议由基于客户端-服务器模型构建的文件共享应用程序使用，这意味着您可以从中心位置下载文件。 |
| **S**ecure **Sh**ell （**SSH）**                             | 22         | 该协议用于通过基于文本的界面安全地登录系统以进行管理。       |
| **H**yper**T**ext 传输协议 （**HTTP**）                      | 80         | 该协议为万维网 （WWW） 提供支持！您的浏览器使用它来下载网页的文本、图像和视频。 |
| **H**yper**T**ext **T**ransfer **P**rotocol **S**ecure （**HTTPS**） | 443        | 该协议的作用与上述完全相同;但是，安全地使用加密。            |
| **S**erver **M**essage **B** 锁 （**SMB**）                  | 445        | 此协议类似于文件传输协议 （FTP）;但是，除了文件之外，SMB 还允许您共享打印机等设备。 |
| **R**emote **D**esktop **P**rotocol （**RDP**）              | 3389       | 此协议是一种使用可视化桌面界面登录系统的安全方法（与 SSH 协议的基于文本的限制相反）。 |

*重要*

我们只简要介绍了网络安全中更常见的协议。有关更多信息，您可以找到[列出的 1024 个常用端口的表 ](http://www.vmaxx.net/techinfo/ports.htm)。

这里值得注意的是，**这些协议只遵循标准**。即，您可以**在标准端口以外的其他端口（在 8080 而不是 80 标准端口上运行 Web 服务器）上管理与这些协议交互的应用程序**。但请注意，应用程序将假定正在遵循标准，因此您必须提供**冒号 （:)** 以及端口号。



## 扩展您的网络

### 1.端口转发

端口转发是将应用程序和服务连接到 Internet 的重要组件。**如果没有端口转发，应用程序和服务（如 Web 服务器）只能用于同一直接网络内的设备。**

以下面的网络为例。在此网络中，IP 地址为“192.168.1.10”的服务器在端口 80 上运行 Web 服务器。只有此网络上的其他两台计算机能够访问它（这称为 Intranet）。

![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/326ef12878c2f669ad2374dba3635a44.svg)





如果管理员希望公众可以访问网站（使用 Internet），则必须实施端口转发，如下图所示：

![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/eb63570eb9f31d26ebd8207ec08058bc.svg)

网络 #2 现在将能够使用网络 #1 的公共 IP 地址 （82.62.51.70） 访问在网络 #1 上运行的 Web 服务器。

很容易将端口转发与防火墙的行为混淆（我们将在后面的任务中讨论这项技术）。但是，在这个阶段，只需了解端口转发会打开特定端口（回想一下数据包的工作原理）。**相比之下，防火墙确定流量是否可以通过这些端口传输（即使这些端口通过端口转发打开）。**

**端口转发在网络的路由器上配置。**



### 防火墙101

防火墙是网络中负责确定允许哪些流量进出的设备。**将防火墙视为网络的边界安全**。管理员可以根据多种因素配置防火墙以**允许 或 拒绝 流量进入或退出网络，例如：**

- 流量来自哪里？（是否告知防火墙接受/拒绝来自特定网络的流量？
- 流量去哪里了？（是否告知防火墙接受/拒绝发往特定网络的流量？
- 流量用于哪个端口？（是否已告知防火墙仅接受/拒绝发往端口 80 的流量？
- 流量使用什么协议？（是否告知防火墙接受/拒绝 UDP、TCP 或两者兼而有之的流量？

防火墙有各种形状和大小。**从可以处理大量数据的专用硬件（通常位于企业等大型网络中）到住宅路由器（如您家中）或 [Snort](https://www.snort.org/) 等软件，防火墙可分为 2 到 5 类。**

我们将在下表中介绍防火墙的两大主要类别：

| **防火墙类别** | **描述**                                                     |
| -------------- | ------------------------------------------------------------ |
| 状态stateful   | 这种类型的防火墙**使用来自连接的全部信息**;此防火墙不是检查单个数据包，而是**根据整个连接**确定设备的行为。与无状态防火墙相比，这种防火墙类型会消耗许多资源，因为决策是动态的。例如， 防火墙可能允许 TCP 握手的第一部分，但稍后会失败。**如果来自主机的连接错误，它将阻止整个设备**。//一错就全停 |
| 无 stateless   | 此防火墙类型使用一组**静态规则**来确定**单个数据包**是否可接受。例如，**发送错误数据包的设备并不一定意味着整个设备随后被阻止**。虽然这些防火墙使用的资源比其他防火墙少得多，**但它们要笨得多**。例如，这些防火墙仅对其中定义的规则有效。如果规则不完全匹配，它实际上就毫无用处。但是，当从一组主机接收大量流量（例如分布式拒绝服务攻击）时，这些防火墙非常有用//**死板的定义** |

### VPN基础

A **V**irtual **P**rivate **N**etwork（或 简称 **VPN** ）是一种技术，它允许不同网络上的设备通过通过 Internet 在彼此之间创建专用路径（称为隧道）来安全地通信。在此隧道中连接的设备将形成自己的专用网络。

例如，只有同一网络（例如企业内部）内的设备才能直接通信。但是，VPN 允许连接两个办公室。让我们看下图，其中有三个网络：![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/418b5637e02d3fd7494affc2e9cdcc86.svg)

只有通过此 VPN 连接的设备才能通过该网络进行通信。让我们在下表中介绍 VPN 提供的其他一些好处：

| **效益**                     | **描述**                                                     |
| ---------------------------- | ------------------------------------------------------------ |
| 允许连接不同地理位置的网络。 | 例如**，拥有多个办事处的企业会发现 VPN 是有益的，因为这意味着可以从另一个办公室访问服务器/基础设施等资源。** |
| 提供隐私。                   | **VPN 技术使用加密来保护数据**。这意味着它只能在发送它的设备和目的地之间被理解，**这意味着数据不易被嗅探。这种加密在网络不提供加密的公共 WiFi 的地方很有用。您可以使用 VPN 来保护您的流量不被其他人查看。** |
| 提供匿名。                   | 记者和活动家依靠 VPN 在言论自由受到控制的国家/地区安全地报道全球问题。**通常，您的 ISP 和其他中介可以查看您的流量，因此可以对其进行跟踪。**VPN 提供的匿名性级别仅与网络上其他设备尊重隐私的方式一样多。例如，在这方面，**记录您所有数据/历史记录的 VPN 与不使用 VPN 本质上相同。** |

TryHackMe 使用 VPN 将您连接到我们易受攻击的机器，而无需在 Internet 上直接访问它们！这意味着：

- 您可以安全地与我们的机器交互
- 服务提供商（如 ISP）**不会认为您正在攻击 Internet 上的另一台计算机（这可能违反服务条款）**
- VPN 为 TryHackMe 提供安全性，因为无法使用 Internet 访问易受攻击的机器。

| **虚拟专用网络科技**vpn | **描述**                                                     |
| ----------------------- | ------------------------------------------------------------ |
| PPP                     | PPTP 使用此技术（如下所述）**来允许身份验证并提供数据加密**。VPN 通过使用私钥和公有证书（类似于 **SSH**）来工作。私钥和证书必须匹配才能连接。**该技术无法自行离开网络**（不可路由）。 |
| PPTP                    | **P**oint-to-**P** oint **T**unneling **P**rotocol （**PPTP**） 是允许来自 PPP 的数据传输和离开网络的技术。 PPTP 非常易于设置，并且大多数设备都支持。但是，与其他选择相比**，它的加密较弱**。 |
| IPSec 系列              | Internet 协议安全 （IPsec） 使用现有的 **I**nternet **P**rotocol （**IP**） 框架对数据进行加密。与其他选择相比，**IPSec 很难设置;但是，如果成功，它拥有强大的加密功能，并且许多设备也支持它。** |



### 路由器与交换机


**什么是交换机？**

交换机是一种专用网络设备，负责提供连接到多个设备的方法。交换机可以使用以太网电缆为许多设备（从 3 到 63 个）提供服务。

交换机可以在 OSI 模型的**第 2 层和第 3 层**运行。但是，这些是排他性的**，因为第 2 层交换机不能在第 3 层运行**。

以下图中的第 2 层交换机为例。这些交换机将使用帧的 MAC 地址将帧（请记住，原始 IP 数据包封装在帧中）转发到连接的设备上。

 ![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/a47c8c191d308906d91f680a5811e492.svg)



这些交换机仅负责将帧发送到正确的设备。

现在，让我们来看看第 3 层交换机。这些交换机比第 2 层更复杂，因为它们可以执行  路由器的一些职责。也就是说，这些交换机将帧发送到设备（就像第 2 层一样），并使用 IP 协议将数据包路由到其他设备。 

 

让我们看一下下图中的第 3 层交换机。我们可以看到有两个 IP 地址：

- 192.168.1.1
- 192.168.2.1

一种称为 **VLAN** （**V**irtual **L**ocal **A**rea **N**etwork） 的技术允许对网络内的特定设备进行虚拟拆分。这种拆分意味着他们都可以从 Internet 连接等中受益，但被单独处理。这种网络分离提供了安全性，因为这意味着现有的规则决定了特定设备如何相互通信。这种分离如下图所示：

 ![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5de96d9ca744773ea7ef8c00/room-content/008ae2ff118eeb5680db5fa478fd925d.svg)

在上图的上下文中，“销售部门”和“会计部门”将能够访问 Internet，但无法相互通信（尽管它们连接到同一交换机）。

## DNS详情

**什么是 DNS？**

DNS（域名系统）Domain Name System为我们提供了一种与 Internet 上的设备进行通信的简单方法，而无需记住复数。就像每栋房子都有一个直接向其发送邮件的唯一地址一样，互联网上的每台计算机都有自己唯一的地址来与之通信，称为 IP 地址。IP 地址类似于以下 104.26.10.229,4 组数字，范围从 0 到 255，用句点分隔。当您想访问一个网站时，记住这组复杂的数字并不十分方便，而这正是 DNS 可以提供帮助的地方。因此，您可以记住 [tryhackme.com](http://tryhackme.com/)，而不是记住 104.26.10.229。

**域层次结构 Domain Hierarchy**

![A diagram of the domain hierarchy, with the root domain at the top, branching into several top-level domains, which in turn brnach into second level domains](D:\Typora\保存文档\网络安全\assets\a168c8511887fff98a6944619c4b5259.png)

**TLD （顶级域名）**

TLD 是域名**最右侧的部分**。因此，例如，[tryhackme.com](http://tryhackme.com/) TLD 是 **.com**。TLD 有两种类型，gTLD（generic通用顶级域名）和 ccTLD（country code国家代码顶级域名）。 从历史上看，**gTLD 旨在 告诉用户域名的用途**;例如，.**com 用于商业** 目的，**.org 用于组织，.edu 用于教育，.gov 用于政府。ccTLD 用于地理目的**，例如 .ca 表示位于加拿大的站点，.co.uk 表示位于英国的站点，依此类推。**由于这种需求，涌入了从 .online 、 .club 、 .website 、 .biz 等 新 gTLD 。有关 2000 多个 TLD 的完整列表，**[ 请单击此处 ](https://data.iana.org/TLD/tlds-alpha-by-domain.txt)。

**二级域名**

以 [tryhackme.com](http://tryhackme.com/) 为例，.com 部分是 TLD，tryhackme 是二级域名。注册域名时，**二级域名限制为 63 个字符 + TLD**，并且只能使用 a-z 0-9 和连字符（不能以连字符开头或结尾或有连续的连字符）。

**子域**

**子域位于二级域的左侧，使用句点分隔它**;例如，在 name [admin.tryhackme.com](http://admin.tryhackme.com/) 中，admin 部分是 **subdomain子域**。子域名具有与二级域相同的创建限制，限制为 63 个字符， 并且只能使用 a-z 0-9 和连字符（不能以连字符开头或结尾，也不能有连续的连字符）。 您可以使用多个子域（用句点拆分）来创建更长的名称，例如 [jupiter.servers.tryhackme.com](http://jupiter.servers.tryhackme.com/)。但长度必须保持在 253 个字符或更少。您可以为域名创建的子域数量没有限制。

### DNS 解析记录类型  DNS Record Types

DNS 不仅适用于网站，还存在多种类型的 DNS 记录。我们将介绍您可能会遇到的一些最常见的问题。

**A 记录**

这些记录解析为 IPv4 地址，例如 104.26.10.229

**AAAA 记录**

这些记录解析为 IPv6 地址，例如 2606：4700：20：：681a：be5

**CNAME 记录** c name

这些记录解析到另一个域名，例如 TryHackMe 的在线商店的子域名 [store.tryhackme.com](http://store.tryhackme.com/) 返回一条 CNAME 记录 [shops.shopify.com](http://shops.shopify.com/)。然后，将向 [shops.shopify.com](http://shops.shopify.com/) 发出另一个 DNS 请求以计算出 IP 地址。

**MX 记录**

这些记录解析为处理您正在**查询的域的电子邮件的服务器的地址**，例如 [，tryhackme.com](http://tryhackme.com/) 的 MX 记录响应将类似于 [alt1.aspmx.l.google.com](http://alt1.aspmx.l.google.com/)。**这些记录还带有 priority 标志**。这**告诉客户以什么顺序尝试服务器，如果主服务器出现故障并且需要将电子邮件发送到备份服务器，这是完美的。**

**TXT 记录**

TXT 记录是**可以存储任何基于文本的数据的自由文本字段**。TXT 记录有多种用途，但一些常见的用途是**列出有权代表域发送电子邮件的服务器**（这有助于打击垃圾邮件和欺骗性电子邮件）。**它们还可用于在注册第三方服务时验证域名的所有权。**

### 提出请求

**发出 DNS 请求时会发生什么情况？**

1. 当您请求域名时，您的计算机首先**会检查其本地缓存，以查看您之前是否最近查找过该地址;如果没有，将向您的递归 DNS 服务器发出请求。**
2. A Recursive**递归 DNS 服务器通常由您的 ISP Internet Service Provider，互联网服务提供商  提供**，但您也可以选择自己的服务器。此服务器还具有最近查找的域名的本地缓存。如果在本地找到结果，则会将其发送回您的计算机，您的请求将在此处结束（这在 Google、Facebook、Twitter 等热门和请求频繁的服务中很常见）。**如果在本地找不到请求，则从 Internet 的根 DNS 服务器开始，开始寻找正确答案。**
3. 根服务器充当互联网的 DNS 主干;他们的工作是根据**您的请求将您重定向到正确的 Top Level Domain Server**。例如，如果您请求 [www.tryhackme.com](http://www.tryhackme.com/)，根服务器将识别 .com 的顶级域，并将您推荐给处理.com 地址的正确 TLD 服务器。
4. **TLD 服务器保存了在何处查找权威服务器以响应 DNS 请求的记录。权威服务器通常也称为域的名称服务器。**例如，[tryhackme.com](http://tryhackme.com/) 的名称服务器是 [kip.ns.cloudflare.com](http://kip.ns.cloudflare.com/) 和 [uma.ns.cloudflare.com](http://uma.ns.cloudflare.com/)。**您通常会为一个域名找到多个名称服务器，以作为备份，以防一个服务器出现故障。**
5. **权威 DNS 服务器是负责存储特定域名的 DNS 记录的服务器，并将在其中对域名 DNS 记录进行任何更新。**然后，根据记录类型，DNS 记录将发送回递归 DNS 服务器，**在那里将缓存本地副本以供将来请求使用，然后中继回发出请求的原始客户端。DNS 记录都带有 TTL （Time To Live） 值。此值是一个以秒为单位表示的数字，应将响应保存到本地，直到您必须再次查找为止。缓存可以节省每次与服务器通信时都必须发出 DNS 请求。**
6. 什么类型的服务器保存域的所有记录？权威服务器authoritative

#### **怎么使用？**

1. ##### **查询 DNS 记录**

- **命令行工具**：

  - **`nslookup`**（跨平台）：

    bash

    ```
    nslookup example.com
    nslookup -type=MX example.com  # 查询邮件服务器
    ```

  - **`dig`**（Linux/Mac）：

    bash

    ```
    dig example.com
    dig +short example.com  # 仅显示 IP
    ```

  - **`whois`**：查询域名注册信息（如 `whois example.com`）。

##### 2. **配置域名解析（购买域名后）**

- **步骤**：
  1. 在域名注册商（如 GoDaddy、阿里云）的管理面板中找到 **DNS 设置**。
  2. 添加记录：
     - **A 记录**：域名 → IPv4（如 `@ → 192.0.2.1`）。
     - **CNAME**：别名指向（如 `www → example.com`）。
     - **MX**：邮件服务器（如 `@ → mail.example.com`）。
  3. 生效时间：通常需几分钟到 48 小时（因 TTL 设置而异）。

##### 3. **搭建私有 DNS 服务器**

- **工具**：Bind9（Linux）、Windows Server DNS 角色。
- **用途**：内网域名解析（如 `internal.company.com`），提升安全性和控制力。

##### 4. **DNS 安全优化**

- **DNSSEC**：防止 DNS 欺骗（需注册商支持）。
- **DoH/DoT**：加密 DNS 查询（如 Firefox 设置中启用 **DNS over HTTPS**）。



![a diagram visualizing the flow described in the text](D:\Typora\保存文档\网络安全\assets\5f04259cf9bf5b57aed2c476-1724075620083.png)

## **What is HTTP? (HyperText Transfer Protocol)**

### **什么是 URL？（统一资源定位器）** **Uniform Resource Locator**

如果您曾经使用过 Internet，那么您以前也使用过 URL。URL 主要是有关如何访问 Internet 上的资源的指令。**下图显示了 URL 及其所有功能的外观（它不会在每个请求中使用所有功能）。**

![A diagram showing different parts of a URL on an example, where http is the scheme, user:password is the user, tryhackme.com is a domain or the host, 80 is the port, view-room is the path, ?id=1 is the query string, and #task3 is the fragment. The full address is http://user:password@tryhackme.com:80/view-room?id=1#task3.](D:\Typora\保存文档\网络安全\assets\34ad66d8b90aaaa35f9536d3b152ea97.png)



**方案：** 这指示使用什么协议来访问资源，例如 HTTP、HTTPS、FTP（文件传输协议）。

**用户：** 某些服务需要身份验证才能登录，您可以在 URL 中输入用户名和密码才能登录。

**主机：** 您要访问的服务器的域名或 IP 地址。

**港口：** 您要连接的端口，通常为 80 用于 HTTP，443 用于 HTTPS，但这可以托管在 1 - 65535 之间的任何端口上。

**路径：** 您尝试访问的资源的文件名或位置。

**查询字符串：** **可以发送到请求路径的额外信息位。**例如，/blog？**id=1** 将告**知博客路径您希望接收 ID 为 1 的博客文章。**

**片段fragment：** 这是对请求的实际页面上的位置的引用。这通常用于内容较长的页面，并且可以将页面的某个部分直接链接到该页面，因此用户一旦访问该页面即可查看该页面。

**提出请求**

只需一行 **GET / HTTP/1.1** 就可以向 Web 服务器发出请求

![img](D:\Typora\保存文档\网络安全\assets\09e70200e7af451077081a3ee3d3708c.png)

但要获得更丰富的 Web 体验，您还需要发送其他数据。这些其他数据以所谓的 headers 形式发送，其中 header 包含额外的信息，以提供给您正在与之通信的 Web 服务器，但我们将在 Header 任务中对此进行更多介绍。

```
GET / HTTP/1.1

Host: tryhackme.com
User-Agent: Mozilla/5.0 Firefox/87.0
Referer: https://tryhackme.com/
```

要分解此请求的每一行，请执行以下作：

**第 1 行：** 此请求将发送 GET 方法（ 在 HTTP 方法 任务中，有更多相关信息），请求带有 / 的主页，并告知 Web 服务器我们使用的是 HTTP 协议版本 1.1。

**第 2 行：** 我们告诉 Web 服务器我们希望网站 tryhackme.com

**第 3 行：** 我们告诉 Web 服务器我们使用的是 Firefox 版本 87 浏览器

**第 4 行：** 我们告诉 Web 服务器，将我们引荐到此网页的网页是 [https://tryhackme.com](https://tryhackme.com/)

**第 5 行：**HTTP 请求**始终以空行结尾**，以通知 Web 服务器请求已完成。

**响应示例：**

```
HTTP/1.1 200 OK

Server: nginx/1.15.8
Date: Fri, 09 Apr 2021 13:34:03 GMT
Content-Type: text/html
Content-Length: 98


<html>
<head>
    <title>TryHackMe</title>
</head>
<body>
    Welcome To TryHackMe.com
</body>
</html>
```

要划分响应的每一行，请执行以下作：

**第 1 行：**HTTP 1.1 是服务器正在使用的 HTTP 协议版本，然后是 HTTP 状态代码（在本例中为“200 OK”），告诉我们请求已成功完成。

**第 2 行：** 这告诉我们 Web 服务器软件和版本号。

**第 3 行：** Web 服务器的当前日期、时间和时区。

**第 4 行：** Content-Type 标**头告诉客户端将发送哪种信息**，例如 HTML、图像、视频、pdf、XML。

**第 5 行：** Content-Length **告诉客户端响应多长时间，这样我们就可以确认没有丢失数据。**

**Line 6:** HTTP response contains a blank line to confirm the end of the HTTP response.

**第 6 行：**HTTP 响应包含一个空行，用于确认 HTTP 响应的结束。

**第 7-14 行：** 已请求的信息，在本例中为主页。

### http方法

HTTP 方法是客户端在发出 HTTP 请求时显示其预期作的一种方式。HTTP 方法有很多 ，但我们将介绍最常见的方法，但大多数情况下您将处理 **GET 和 POST 方法**。

**获取请求**

这用于从 Web 服务器获取信息。

**发布请求**

这用于**将数据提交到 Web 服务器并可能创建新记录**

**放请求**PUT

这用于将数据提交到 Web 服务器以更新信息

**删除请求**DELETE

这用于从 Web 服务器中删除信息/记录。

### http状态代码

在上一个任务中，您了解到，当 HTTP 服务器响应时，**第一行始终包含一个状态代码**，告知客户端其请求的结果以及可能如何处理该请求。这些状态代码可以分为 5 个不同的范围：

| **100-199 - 信息响应**   | 发送这些请求是为了告诉客户端其请求的第一部分已被接受，他们应该继续发送请求的其余部分 。这些代码不再很常见。 |
| ------------------------ | ------------------------------------------------------------ |
| **200-299 - 成功**       | 此状态代码范围用于告诉客户端其请求成功。                     |
| **300-399 - 重定向**     | 这些用于将客户端的请求重定向到另一个资源。这可以是不同的网页，也可以是完全不同的网站。 |
| **400-499 - 客户端错误** | 用于通知客户端其请求有错误。                                 |
| **500-599 - 服务器错误** | 这是为服务器端发生的错误保留的，通常表示处理请求的服务器存在相当大的问题。 |

**常见的 HTTP 状态代码：**

有很多不同的 HTTP 状态代码，这还不包括应用程序甚至可以定义自己的 HTTP 状态代码，我们将介绍您可能遇到的最常见的 HTTP 响应：

| **200 - 正常**         | 请求已成功完成。                                             |
| ---------------------- | ------------------------------------------------------------ |
| **201 - 已创建**       | 已创建资源（例如，新用户或新博客文章）。                     |
| **301 - 永久移动**     | 这会将客户的浏览器重定向到新网页，或告诉搜索引擎该页面已移至其他位置并改为查看那里。 |
| **302 - 找到**         | 与上述永久重定向类似，但顾名思义，这只是一个临时更改，在不久的将来可能会再次更改。 |
| **400 - 错误请求**     | 这会告诉浏览器他们的请求中有错误或缺失。如果请求的 Web 服务器资源需要客户端未发送的特定参数，则有时可以使用此方法。 |
| **401 - 未授权**       | 在您授权 Web 应用程序（通常是使用用户名和密码）之前，您当前不允许查看此资源。 |
| **403 - 禁止**         | 无论您是否登录，您都无权查看此资源。                         |
| **405 - 不允许使用**   | 资源不允许此方法请求，例如，您向资源 /create-account 发送 GET 请求，而它需要 POST 请求。 |
| **404 - 未找到页面**   | 您请求的页面/资源不存在。                                    |
| **500 - 内部服务错误** | 服务器在您的请求中遇到了某种错误，它不知道如何正确处理。     |
| **503 - 服务不可用**   | 此服务器无法处理您的请求，因为它已过载或停机进行维护。       |

### header 标头

标头是您在发出请求时可以发送到 Web 服务器的附加数据位。

**通用请求标头** common request header

﻿这些是从客户端（通常是您的浏览器）发送到服务器的标头。

**主机host：** 一些 Web 服务器托管多个网站，因此通过提供主机标头，您可以告诉它您需要哪个网站，否则您只会收到服务器的默认网站。

**用户代理user agent：** 这是您的浏览器软件和版本号，**告诉 Web 服务器您的浏览器软件有助于它为您的浏览器正确格式化网站，并且 HTML、JavaScript 和 CSS 的某些元素仅在某些浏览器中可用。**

**内容长度content length：** 将数据发送到 Web 服务器（例如在表单中）时，内容长度会告知 Web 服务器 Web 请求中预期有多少数据。这样，服务器可以确保它不会丢失任何数据。

**Accept-Encoding 中：** 告诉 Web 服务器浏览器支持哪些类型的压缩方法，以便可以缩小数据以通过 Internet 传输。

**饼干cookie：** 发送到服务器**以帮助记住您的信息的数据**（有关更多信息，请参阅 Cookie 任务）。

**常见响应标头**

这些是在请求后从服务器返回给客户端的标头。

**Set-Cookie 中：** **要存储的信息将在每个请求中发送回 Web 服务器**（请参阅 cookie 任务以了解更多信息）。

**缓存控制 **Cache-Control**：** 在浏览器再次请求响应之前，将响应内容存储在浏览器的缓存中多长时间。

**内容类型 **Content-Type**：** 这**会告诉客户端返回什么类型的**数据，即 HTML、CSS、JavaScript、图像、PDF、视频等。使用 content-type 标头，浏览器就可以知道如何处理数据。

**内容编码 **Content-Encoding**：** 通过 Internet 发送数据时**，使用了什么方法来压缩数据以使其更小。**

### cookie

**您以前可能听说过 cookie，它们只是存储在您计算机上的一小段数据。**

当您从 Web 服务器收到 “Set-Cookie” 标头时，将保存 Cookie。然后**，您发出的每个进一步请求，您都会将 cookie 数据发送回 Web 服务器**。由于 HTTP 是**无状态的**（不会跟踪您以前的请求）**，因此 cookie 可用于提醒 Web 服务器您是谁、网站的一些个人设置或您以前是否访问过该网站**。让我们看一下这个 HTTP 请求示例：

![A diagram visualizing how cookies are introduced in http requests to allow storing user information](D:\Typora\保存文档\网络安全\assets\a2117dc267fbb169e38be77c7af44027.png)

Cookie 可用于多种用途，但最常用于网站身份验证。**cookie 值通常不是您可以看到密码的明文字符串，而是令牌（人类不容易猜到的唯一密码）。**

**查看您的 Cookie**

**您可以在浏览器中使用开发人员工具轻松查看浏览器向网站发送的 Cookie。如果您不确定如何在浏览器中访问开发人员工具，请单击此任务顶部的“查看站点”按钮以获取作指南。**

**打开开发人员工具后，单击“Network”（网络）选项卡。此选项卡将向您显示浏览器请求的所有资源的列表。您可以单击每个选项以接收请求和响应的详细分类。如果您的浏览器发送了 Cookie，您将在请求的“Cookie”选项卡上看到这些 Cookie。**

http://tryhackme.com/blog?id=1  访问id=1的blog

```
POST /login HTTP/1.1

Host: tryhackme.com

User-Agent: Mozilla/5.0 Firefox/87.0

Content-Length: 29

Content-Type: application/x-www-form-urlencoded


username=thm&password=letmein   //实例，用&链接
```

## 网站如何运作

分前后端通过网络传输顺数据

**1.html**

网站主要使用以下方法创建：

- HTML，用于构建网站并定义其结构
- CSS，通过添加样式选项使网站看起来更漂亮
- JavaScript，使用交互性在页面上实现复杂功能

**H**yper**T**ext**M**arkup **L**anguage （HTML） 是网站编写的语言。元素（也称为标签）是 HTML 页面的构建块，它告诉浏览器如何显示内容。下面的代码片段显示了一个简单的 HTML 文档，其结构对于每个网站都是相同的：

![img](D:\Typora\保存文档\网络安全\assets\example_html.png)

HTML 结构（如屏幕截图所示）包含以下组件：

- `<！DOCTYPE html>` 定义页面是 HTML5 文档。这有助于跨不同浏览器实现标准化，并告诉浏览器使用 HTML5 来解释页面。
- `<html>` 元素是 HTML 页面的根元素 - 所有其他元素都位于此元素之后。
- `<head>` 元素包含有关页面的信息（如页面标题）
- `<body>` 元素定义 HTML 文档的正文;浏览器中仅显示正文内的内容。
- `<h1>` 元素定义一个大标题
- `<p>` 元素定义段落
- 还有许多其他元素 （标签） 用于不同的目的。例如，有按钮 （`<button>`）、图像 （`<img>`）、列表等的标签。 

**详见小程序学习。**

**2.js**

JavaScript 添加到页面源代码中，可以在 `<script>` 标记中加载，也可以与 src 属性一起远程包含： `<script src="/location/of/javascript_file.js"></script>`

以下 JavaScript 代码在页面上查找 id 为 “demo” 的 HTML 元素，并将该元素的内容更改为 “Hack the Planet” ： `document.getElementById("demo").innerHTML = "Hack the Planet";`

HTML 元素还可以具有事件，例如“onclick”或“onhover”，这些事件会在事件发生时执行 JavaScript。以下代码将具有演示 ID 的元素的文本更改为 Button Clicked： `<button onclick='document.getElementById("demo").innerHTML = "Button Clicked";'>Click Me!</button>` - onclick 事件也可以在 JavaScript 脚本标记内定义，而不是直接在元素上定义。 

#### 3.敏感数据泄露

当网站没有正确保护（或删除）对最终用户的敏感明文信息时，就会发生敏感数据泄露;通**常位于站点的前端源代码中。**

我们现在知道网站是使用许多 HTML 元素（标签）构建的，我们只需 “查看页面源” 即可看到所有这些元素。网站开发人员可能忘记删除登录凭据、指向网站私人部分的隐藏链接或 HTML 或 JavaScript 中显示的其他敏感数据。

**敏感信息可能被用来进一步阻止攻击者在 Web 应用程序的不同部分内进行访问。**例如，可能存在**带有临时登录凭据的** HTML 注释，如果您查看了页面的源代码并找到了它，**您可以使用这些凭据在应用程序的其他位置登录**（或者更糟的是，用于访问网站的其他后端组件）。

![img](D:\Typora\保存文档\网络安全\assets\html_source.png)

每当评估 Web 应用程序是否存在安全问题时，您应该做的第一件事就是查看页面源代码，看看是否可以找到任何暴露的登录凭证或隐藏的链接。

#### 漏洞 HTML注入//重要

**HTML 注入是页面上显示未经筛选的用户输入时发生的漏洞。** 如果网站未能清理用户输入（**过滤用户输入网站的任何“恶意”文本），并且该输入被用于页面，则攻击者可以将 HTML 代码注入易受攻击的网站。**

输入清理对于保持网站安全非常重要，因为用户输入网站的信息通常用于其他前端和后端功能。您将在另一个实验中探讨的一个漏洞是**数据库注入sql**，在该实验中**，您可以通过控制查询中直接使用的输入来纵数据库查找查询以其他用户身份登录 - 但现在，让我们专注于 HTML 注入（客户端）。**

当用户可以**控制其输入的显示方式时，他们可以提交 HTML（或 JavaScript）代码，浏览器将在页面上使用它，从而允许用户控制页面的外观和功能。**

![img](https://tryhackme-images.s3.amazonaws.com/user-uploads/5c549500924ec576f953d9fc/room-content/9c3ea7c9bcd06f125950e03aa814116a.svg)

上图显示了表单如何将文本输出到页面。无论用户在“What's your name”字段中输入的内容是什么，都会传递到 JavaScript 函数并输出到页面，这意味着如果用户在字段中添加了自己的 HTML 或 JavaScript，它就会在 sayHi 函数中使用并被添加到页面中——这意味着您可以添加自己的 HTML（例如<h1>标签），它会将您的输入输出为纯 HTML。

**一般规则是永远不要相信用户输入**。为防止恶意输入，网站开发人员应在 JavaScript 函数中使用用户输入的所有内容之前对其进行清理;在这种情况下，**开发人员可以删除任何 HTML 标记。**

## 把它们放在一起

从前面的模块中，您将了解到，当您在浏览器中请求网页时，幕后会发生很多事情。

总而言之，当您请求网站时，**您的计算机需要知道它需要与之通信的服务器的 IP 地址;为此，它使用 DNS。然后，您的计算机使用一组称为 HTTP 协议的特殊命令与 Web 服务器通信;然后，网络服务器返回 HTML、JavaScript、CSS、图像等，然后您的浏览器会使用它们来正确格式化和向您显示网站。**



**其他组件**

**负载均衡器**

当网站的流量开始变得相当大或正在运行需要高可用性的应用程序时，一个 Web 服务器可能不再执行该工作**。负载均衡器提供两个主要功能，确保高流量网站可以处理负载，并在服务器无响应时提供故障转移。**

当您请求具有负载均衡器的网站时，负载均衡器将首先收到您的请求，然后将其转发到其后面的多个服务器之一。负载均衡器使用不同的算法来帮助它决定哪个服务器最适合处理请求。这些算法的几个示例是 **round-robin**，它依次将其发送到每个服务器，或 **weighted**，它检查服务器当前正在处理多少个请求并将其发送到最不繁忙的服务器。

负载均衡器还会对每个服务器执行定期检查，以确保它们正常运行;这称为**运行状况检查** 。如果服务器没有正确响应或未响应，负载均衡器将停止发送流量，直到它再次做出适当的响应。

**CDN（内容分发网络）**(Content Delivery Networks)****

CDN 可以成为减少繁忙网站流量的绝佳资源。**它允许您托管您网站上的静态文件，例如 JavaScript、CSS、图像、视频，并将它们托管在全球数千台服务器上。**当用户请求其中一个托管文件时，CDN 会找出最近的服务器的物理位置，并将请求发送到那里，而不是可能发送到世界的另一端。

**数据库**

通常，网站需要一种方法来为其用户存储信息。**Web 服务器可以与数据库通信以存储和调用数据库中的数据**。数据库的范围可以从简单的纯文本文件到由多个服务器组成的复杂集群，从而提供速度和弹性。**您会遇到一些常见的数据库：MySQL、MSSQL、MongoDB、Postgres 等;每个都有其特定的功能。**

**WAF （Web 应用程序防火墙 ）****Web Application Firewall)**

WAF 位于 Web 请求和 Web 服务器之间;其主要目的是保护 Web 服务器免受黑客攻击或拒绝服务攻击**。它分析常见攻击技术的 Web 请求，无论请求是否来自真实浏览器而不是机器人程序**。它还通过使用**称为速率限制的功能来检查是否发送了过多的 Web 请求，该限制每秒只允许来自某个 IP 的一定数量的请求**。如果请求被视为潜在攻击，则它将被丢弃，并且永远不会发送到 Web 服务器。

### **Web 服务器的工作原理。**

**什么是 Web 服务器？
**

Web 服务器是一种软件，它侦听传入的连接，然后利用 HTTP 协议将 Web 内容交付给其客户端。您会遇到的最常见的 Web 服务器软件是 **Apache、Nginx、IIS 和 NodeJS**。Web 服务器从其根目录（在软件设置中定义）传送文件。**例如，Nginx 和 Apache 在 Linux 作系统中共享相同的默认位置 /var/www/html**，**而 IIS 对 Windows 作系统使用 C：\inetpub\wwwroot。因此，例如，如果您请求文件 [http：//www.example.com/picture.jpg](http://www.example.com/picture.jpg)，它将从其本地硬盘驱动器发送文件** /var/www/html/picture.jpg。

**虚拟主机**

Web 服务器可以托管多个不同域名的网站;为了实现这一目标，他们使用虚拟主机。Web 服务器软件检查从 HTTP 标头请求的主机名，并将其与其虚拟主机（虚拟主机只是基于文本的配置文件）进行匹配。**如果找到匹配项，将提供正确的网站。如果未找到匹配项，则将改为提供默认网站。**

虚拟主机可以将其根目录映射到硬盘驱动器上的不同位置。例如，[one.com](http://one.com/) 映射到 /var/www/[website_one，two.com](http://two.com/) 映射到 /var/www/website_two

您可以在 Web 服务器上托管的不同网站数量没有限制。 

**静态与动态内容** **Static Vs Dynamic Content**

静态内容，顾名思义，是永不改变的内容。这方面的常见示例是图片、javascript、CSS 等，但也可以包括永不更改的 HTML。此外，这些文件直接从 Web 服务器提供，无需对其进行任何更改。

另一方面**，动态内容是可能随不同请求而变化的内容。以博客为例。在博客的主页上，它会向您展示最新的条目。如果创建了新条目，则主页将更新为最新条目，或者第二个示例可能是博客上的搜索页。根据您搜索的单词，将显示不同的结果。**

您最终看到的这些更改是使用编程和脚本语言在所谓的**后端** 中完成的。它被称为 **Backend**，因为正在做的事情都是在幕后完成的。您无法查看网站的 HTML 源并查看后端发生的情况，而 HTML 是从后端处理的结果。您在浏览器中看到的所有内容都称为 **Frontend。**前端

**脚本和后端语言** **Scripting and Backend Languages**

后端语言可以实现的目标没有太大限制，这些就是使网站与用户互动的原因。这些语言的一些示例（排名不分先后:p）**包括 PHP、Python、Ruby、NodeJS、Perl 等等**。这些语言可以与数据库交互、调用外部服务、处理来自用户的数据等等。一个非常基本的 PHP 示例是，如果您请求网站 [http：//example.com/index。php？name=亚当](http://example.com/index.php?name=adam)
[
](http://example.com/index.php?name=adam)

如果 index.PHP 是这样构建的：

```
<html><body>Hello <?php echo $_GET["name"]; ?></body></html>
```

它将向客户端输出以下内容：

```
<html><body>Hello adam</body></html>
```

**您会注意到客户端看不到任何 PHP 代码，因为它位于 Backend 上** 。这种交互性会给尚未安全创建的 Web 应用程序带来更多安全问题，您将在进一步的模块中学习。



## windows

**系统配置**实用程序 （`MSConfig`） 用于高级故障排除，其主要目的是帮助诊断启动问题。 

该实用程序的顶部有五个选项卡。以下是每个选项卡的名称。我们将简要介绍此任务中的每个选项卡。

1. 常规
2. 靴子
3. 服务业
4. 启动
5. 工具
6. General
7. Boot
8. Services
9. Startup
10. Tools

**cmd**

让我们从几个简单的命令开始，比如 `hostname` 和 `whoami`。

命令 **hostname** 将输出计算机名称。

![img](D:\Typora\保存文档\网络安全\assets\hostname.png)

命令 **whoami** 将输出已登录用户的名称。

![img](D:\Typora\保存文档\网络安全\assets\whoami.png)

接下来，让我们看看一些在故障排除时有用的命令。

经常使用的命令是 `ipconfig`。此命令将显示计算机的网络地址设置。

![img](D:\Typora\保存文档\网络安全\assets\ipconfig.png)

每个命令都将有一个帮助手册，用于解释正确执行命令的预期语法，以及可以添加到命令以扩展其执行的任何其他参数。

用于检索命令的帮助手册的命令是 `/？`。

例如，要查看 **ipconfig** 的帮助手册，您可以使用以下命令：`ipconfig /？`

![img](D:\Typora\保存文档\网络安全\assets\ipconfig-help.png)

**注** ： 要清除命令提示符屏幕，命令为 `cls`。 

下一个命令是 `netstat`。根据帮助手册，此命令将显示协议统计信息和当前的 TCP/IP 网络连接。 

![img](D:\Typora\保存文档\网络安全\assets\netstat.png)

在上图中，红框内的行向我们展示了该命令的示例语法。

该结构告诉我们 **netstat** 命令可以单独运行，也可以与参数（如 `-a`、 `-b`、 `-e` 等）一起运行。 

当任何参数附加到根命令（在本例中为 **netstat**）时，输出会发生变化。玩几个自己看看。 

`net` 命令主要用于管理网络资源。 该命令支持子命令。

如果键入 **net** 而不带子命令，则输出将显示 root 命令的语法，其中显示了一些可以使用的子命令。

![img](D:\Typora\保存文档\网络安全\assets\net.png)

对于 net 命令，显示帮助手册 `/？` 将不起作用。在这种情况下，您需要使用不同的语法，这是 `net help`。

![img](D:\Typora\保存文档\网络安全\assets\net-help.png)

因此，如果您希望查看 `net user` 的帮助信息，则命令为 `net help user`。 

![img](D:\Typora\保存文档\网络安全\assets\net-help-user2.png)

您可以使用同一命令查看其他有用的 **net** 子命令（如 **localgroup**、**use**、**share** 和 **session**）的帮助信息。 

请参阅以下链接，在此处查看您可以在[命令提示符](https://ss64.com/nt/)中执行的命令的完整列表。 

### windows域

想象一下，您管理着一个只有 5 台计算机和 5 名员工的小型企业网络。在如此小的网络中，您可能能够毫无问题地单独配置每台计算机。您将手动登录每台计算机，为使用它们的人创建用户，并为每个员工的帐户进行特定配置。如果用户的计算机停止工作，您可能会去他们的地方并在现场修复计算机。

虽然这听起来像是一种非常轻松的生活方式，但假设您的企业突然增长，现在有 157 台计算机和 320 个不同的用户分布在四个不同的办公室。您是否仍然能够将每台计算机作为单独的实体进行管理，为网络中的每个用户手动配置策略，并为每个人提供现场支持？答案很可能是否定的。

为了克服这些限制，我们可以使用 Windows 域。简单地说，**Windows 域**是给定企业管理下的一组用户和计算机。域背后的主要思想是将 Windows 计算机网络的常见组件集中在一个名为 **Active Directory （AD）** 的存储库中。运行 Active Directory 服务的服务器称为**域控制器 （DC）。**![Windows Domain Overview](D:\Typora\保存文档\网络安全\assets\bebe5dfec0208bf563d01fa2dd1fb7a7.png)

配置一个 Windows 域的主要优点是：

- **集中式身份管理：** 网络中的所有用户都可以从 Active Directory 轻松配置。
- **管理安全策略：** 您可以直接从 Active Directory 配置安全策略，并根据需要将其应用于网络上的用户和计算机。

在学校/大学网络中，通常会为您提供用户名和密码，您可以在校园内的任何可用计算机上使用。您的凭据对所有计算机都有效，因为每当您在计算机上输入凭据时，**它都会将身份验证过程转发回 Active Directory，在那里将检查您的凭据。借助 Active Directory，您的凭据不需要存在于每台计算机中，并且可以在整个网络中使用。**

**Active Directory 也是允许您的学校/大学限制您访问学校/大学计算机上的控制面板的组件。策略将部署在整个网络中，因此您没有对这些计算机的管理权限。**

#### AD

任何 Windows 域的核心都是 **Active Directory** 域服务 （AD DS）。 该服务充当目录，保存网络上存在的所有 “对象” 的信息。在 AD 支持的众多对象中，我们有用户、组、机器、打印机、共享和许多其他对象。让我们看看其中的一些：

**用户**

用户是 Active Directory 中最常见的对象类型之一。用户是**称为安全主体的对象之一，**这意味着他们可以通过域进行身份验证，并且可以分配对文件或打印机等资源的权限。您可以说安全委托人是可以作用于网络中资源的对象。

用户 可用于表示两种类型的实体：

**人员： 用户通常代表组织中需要访问网络的人员，例如员工。**
**服务： 您还可以定义 IIS 或 MSSQL 等服务要使用的用户。每个服务都需要一个用户才能运行，但服务用户与普通用户不同，因为他们仅具有运行其特定服务所需的权限。**

***机器\***

计算机是 Active Directory 中的另一种类型的对象;对于加入 Active Directory 域的每台计算机，将创建一个计算机对象。计算机也被视为“安全主体”，并像任何常规用户一样分配一个帐户。此帐户在域本身中具有一些有限的权限。

计算机帐户本身是指定计算机上的本地管理员，通常不应由计算机本身以外的任何人访问，但与任何其他帐户一样，如果您有密码，则可以使用它登录。

**注意：** **计算机帐户密码会自动轮换出去，通常由 120 个随机字符组成。**

识别计算机帐户相对容易。它们遵循特定的命名方案。**计算机帐户名称是计算机的名称，后跟一个美元符号。例如，名为 `DC01` 的计算机将具有名为 `DC01$` 的计算机帐户。**

***安全组\***

如果您熟悉 Windows，则可能知道可以定义用户组，以便将文件或其他资源的访问权限分配给整个组，而不是单个用户。这样可以提高可管理性，因为您可以将用户添加到现有组，并且他们将自动继承该组的所有权限。**安全组也被视为安全委托人，因此可以拥有对网络上资源的权限。**

**组可以同时将用户和计算机作为成员。如果需要，组也可以包括其他组。**

默认情况下，在域中会创建多个组，这些组可用于向用户授予特定权限。例如，以下是域中一些最重要的组：

| **安全组**           | **描述**                                                     |
| -------------------- | ------------------------------------------------------------ |
| 域管理员domain admin | 此组的用户对整个域具有管理权限。默认情况下，他们可以管理域上的任何计算机，包括 DC。 |
| 服务器作员           | 此组中的用户可以管理 Domain Controllers。他们无法更改任何管理组成员身份。 |
| 备份作员             | 允许此组中的用户访问任何文件，而忽略其权限。它们用于在计算机上执行数据备份。 |
| Account Operators    | 此组中的用户可以创建或修改域中的其他帐户。                   |
| 域用户               | 包括域中的所有现有用户帐户。                                 |
| 域计算机             | 包括域中的所有现有计算机。                                   |
| 域控制器             | 包括域上的所有现有 DC。                                      |

#### **Active Directory 用户和计算机**

要在 Active Directory 中配置用户、组或计算机，我们需要登录到域控制器并从开始菜单运行“Active Directory 用户和计算机”：

![Start menu AD Users and Computers](D:\Typora\保存文档\网络安全\assets\11d01963392078c1450300d2881f9160.png)

这将打开一个窗口，您可以在其中查看域中存在的用户、计算机和组的层次结构。这些对象按**组织单位 **Organizational Units （OU）进行组织，组织单位是允许您对用户和计算机进行分类的容器对象。**OU 主要用于定义具有类似监管要求的用户集。例如，您组织销售部门的人员可能应用了一组与 IT 人员不同的策略。请记住，用户一次只能是单个 OU 的一部分。**

检查我们的机器，**我们可以看到已经有一个名为 `THM` 的 OU，其中包含 IT、管理、营销、研发和销售部门的五个子 OU。看到 OU 模仿业务结构是非常典型的，因为它允许有效地部署适用于整个部门的基准策略。请记住，虽然这在大多数情况下是预期的模型，但您可以任意定义 OU。随意右键单击 `THM` OU 并在其下创建一个名为 `Students` 的新 OU，只是为了好玩。**

![AD Users and Computers](D:\Typora\保存文档\网络安全\assets\678ecc92c80aa206339f0f23-1751295060748.png)

您可能已经注意到，除了 **THMOU 之外，还有其他默认容器。这些容器由 Windows 自动创建，包含以下内容：**

- **内置：** 包含可用于任何 Windows 主机的默认组。
- **计算机：** 默认情况下，任何加入网络的计算机都将放在这里。如果需要，您可以移动它们。
- **域控制器：** 包含网络中 DC 的默认 OU。
- **用户：** 适用于网域范围上下文的默认用户和用户组。
- **托管服务帐户：** 保留 Windows 域中的服务使用的账户。

- **Builtin:** Contains default groups available to any Windows host.
- **Computers:** Any machine joining the network will be put here by default. You can move them if needed.
- **Domain Controllers:** Default OU that contains the DCs in your network.
- **Users:** Default users and groups that apply to a domain-wide context.
- **Managed Service Accounts:** Holds accounts used by services in your Windows domain.

#### **安全组与 OU**

您可能想知道为什么我们同时有组和 OU。虽然两者都用于对用户和计算机进行分类**，但它们的用途完全不同：**

- **OU** 对于 **将策略应用于**用户和计算机非常方便，其中包括与用户组相关的特定配置，具体取决于他们在企业中的特定角色。请记住，用户一次只能是单个 OU 的成员，因为尝试将两组不同的策略应用于单个用户是没有意义的。
- 另一方面， **安全组**用于**授予对资源的权限** 。例如，如果要允许某些用户访问共享文件夹或网络打印机，则可以使用组。一个用户可以是多个组的一部分，这是授予对多个资源的访问权限所必需的。

**作为新域管理员，您的第一项任务是检查现有的 AD OU 和用户，因为业务最近发生了一些变化。您已获得以下组织结构图，并应对 AD 进行更改以匹配它：**

![THM Organisational Chart](D:\Typora\保存文档\网络安全\assets\88f0ade5a672ae681639e6049406a4ec.png)



**删除额外的 OU 和用户**

您应该注意的第一件事是，您当前的 AD 配置中还有一个额外的部门 OU 未显示在图表中。我们被告知，由于预算削减，它已关闭，应该从域中删除。如果您尝试右键单击并删除 OU， 您将收到以下错误：

![OU delete error](D:\Typora\保存文档\网络安全\assets\38edaf4a8665c257c62556096c69cb6f.png)



默认情况下，OU 受到保护，防止意外删除。要删除 OU，我们需要在 View 菜单中启用 **Advanced Features**：

![Enabling advanced features](D:\Typora\保存文档\网络安全\assets\15b282b6e3940f4c26c477a8c21f8266.png)

这将向您显示一些额外的容器，**并使您能够禁用意外删除保护**。为此，请右键单击 OU 并转到 Properties （属性）。您将在 Object （对象） 选项卡中找到一个复选框以禁用保护：

![Disable OU delete protection](D:\Typora\保存文档\网络安全\assets\ad6b6d886c0448d14ce4ec8c62250256.png)

删除额外的 OU 后，您应该注意到，对于某些部门，AD 中的用户与我们组织结构图中的用户不匹配。**根据需要创建和删除用户以匹配他们。**

#### Delegation 代表团 委派

在 AD 中可以做的一件好事是让特定用户对某些 OU 有一定的控制权。此过程称为**委派** ，允许您授予用户特定权限以在 OU 上执行高级任务，而无需域管理员介入。

**最常见的用例之一是授予 `IT 支持`重置其他低权限用户密码的权限。根据我们的组织结构图，Phillip 负责 IT 支持，因此我们可能希望将重置 Sales、Marketing 和 Management OU 密码的控制权委托给他。**

在此示例中，我们将把 Sales OU 的控制权委托给 Phillip。要委派对 OU 的控制权，您可以右键单击它并选择 **Delegate Control （委派控制权** ）：![Delegating OU control](D:\Typora\保存文档\网络安全\assets\74f8d615658a03aeb1cfdb6767d0a0a3.png)

这应该会打开一个新窗口，其中将首先询问要委派控制权的用户：

**注意：** 为避免键入错误的用户名称，请输入 “phillip” 并单击 **Check Names** 按钮。Windows 将为您自动完成用户。

![Delegating Sales OU to Phillip](D:\Typora\保存文档\网络安全\assets\2814715e1dbadaef334973028e02da69.png)

单击 OK，然后在下一步中选择以下选项：![Delegating password resets](D:\Typora\保存文档\网络安全\assets\3f81df2b38e35ca5729aee7a76c6b220.png)

**单击 next 几次**，现在 Phillip 应该能够重置销售部门中任何用户的密码。**虽然您可能希望重复这些步骤以委派营销和管理部门的密码重置，但我们将将其留在这里以执行此任务。如果您愿意，您可以自由地继续配置其余的 OU。**

现在，让我们使用 Phillip 的帐户尝试重置 Sophie 的密码。以下是 Phillip 的凭据，供您通过 RDP 登录：

虽然您可能很想去 **Active Directory 用户和计算机**尝试测试 Phillip 的新能力，**但他实际上没有打开它的权限，**因此您必须使用其他方法来进行密码重置。在这种情况下，我们将使用 **Powershell 来执行此作**：

```
PS C:\Users\phillip> Set-ADAccountPassword sophie -Reset -NewPassword (Read-Host -AsSecureString -Prompt 'New Password') -Verbose

New Password: *********

VERBOSE: Performing the operation "Set-ADAccountPassword" on target "CN=Sophie,OU=Sales,OU=THM,DC=thm,DC=local".
```

由于我们不希望 Sophie 继续使用我们知道的密码，因此我们还可以使用以下命令在下次登录时强制重置密码：

```
PS C:\Users\phillip> Set-ADUser -ChangePasswordAtLogon $true -Identity sophie -Verbose

VERBOSE: Performing the operation "Set" on target "CN=Sophie,OU=Sales,OU=THM,DC=thm,DC=local".
```



#### 管理计算机

我们可以看到与我们网络中的用户相对应的一些服务器、一些笔记本电脑和一些 PC。拥有我们所有的设备并不是最好的主意，因为您很可能希望为服务器和普通用户每天使用的机器使用不同的策略。

虽然没有关于如何组织机器的黄金法则，但一个很好的起点是根据设备的用途来隔离设备。一般来说，您预计设备至少分为以下三个类别：

**1. 工作站**

工作站是 Active Directory 域中最常见的设备之一。域中的每个用户都可能登录到工作站。这是他们将用于完成工作或正常浏览活动的设备。这些设备绝不应有特权用户登录。

**2. 服务器**

服务器是 Active Directory 域中第二常见的设备。服务器通常用于向用户或其他服务器提供服务。

**3. 域控制器**

域控制器是 Active Directory 域中第三大最常见的设备。域控制器允许您管理 Active Directory 域。这些设备通常被视为网络中最敏感的设备，因为它们包含环境中所有用户帐户的哈希密码。

由于我们正在整理 AD，让我们为`工作站`和`服务器`创建两个单独的 OU（域控制器已经在 Windows 创建的 OU 中）。我们将直接在 `thm.local` 域容器下创建它们。最后，您应该具有以下 OU 结构：

![final OU structure](D:\Typora\保存文档\网络安全\assets\09405010962071f21c6dee7b4eb8c59a.png)

现在，将个人计算机和笔记本电脑从 Computers 容器移动到 Workstations OU，将服务器移动到 Servers OU。这样做将允许我们稍后为每个 OU 配置策略。

#### 组策略 **Group Policy Objects** 

到目前为止，我们只是为了在 OU 中组织用户和计算机，但这背后的主要思想是能够为每个 OU 单独部署不同的策略。这样，我们就可以根据用户的部门向用户推送不同的配置和安全基线。

Windows 通过**组策略对象 （GPO） **Group Policy Objects** ** 管理此类策略。GPO 只是可应用于 OU 的设置集合。GPO 可以包含针对用户或计算机的策略，从而允许您在特定计算机和身份上设置基准。

要配置 GPO，您可以使用“开始”菜单中提供的**组策略管理工具** ：

![Start menu GPM](D:\Typora\保存文档\网络安全\assets\b19052c41e27fbbb2651038cede63e11.png)

打开它时，您首先看到的是完整的 OU 层次结构，如前所述。要配置组策略，首先在**组策略对象** 下创建一个 GPO，然后将其链接到要应用策略的 OU。例如，您可以看到您的计算机中已经存在一些 GPO：

![Existing OUs in your machine](D:\Typora\保存文档\网络安全\assets\d82cb9440894c831f6f3d58a2b0538ed.png)

在上图中，我们可以看到已经创建了 3 个 GPO。从中，` 默认域策略`和 `RDP 策略`作为一个整体链接到 `thm.local` 域，并且 `Default Domain Controllers Policy` 仅链接到`域控制器 `OU。需要记住的重要一点是，任何 GPO 都将适用于链接的 OU 及其下的任何子 OU。例如，`Sales`OU 仍将受到 `Default Domain Policy` 的影响。

让我们检查一下 `Default Domain Policy （默认域策略 `） 以查看 GPO 中的内容。选择 GPO 时看到的第一个选项卡显示其**范围** ，即 GPO 在 AD 中的链接位置。对于当前策略，我们可以看到它只链接到 `thm.local` 域：

如您所见，您还可以将**安全筛选**   **Security Filtering**应用于 GPO，以便它们仅应用于 OU 下的特定用户/计算机。默认情况下，它们将应用于 **Authenticated Users** 组，其中包括所有**用户/PC**。

**Settings** （ **设置** ） 选项卡包括 GPO 的实际内容，并让我们知道它应用了哪些特定配置。如前所述，每个 GPO 都有仅适用于计算机的配置和仅适用于用户的配置。在这种情况下，` 默认域策略`仅包含计算机配置：

![OU Settings](D:\Typora\保存文档\网络安全\assets\c9293853549d5126b77bf2de8086e076.png)

您可以随意浏览 GPO 并使用每个配置右侧的 “show” 链接扩展可用项目。在这种情况下，` 默认域策略`指示应应用于大多数域的真正基本配置，包括密码和帐户锁定策略：

![OU detailed settings](D:\Typora\保存文档\网络安全\assets\a5f4c2605062934579c64f2cfa025308.png)

由于此 GPO 适用于整个域，因此对它的任何更改都将影响所有计算机。**让我们更改最小密码长度策略，要求用户的密码中至少有 10 个字符**。为此，请右键单击 GPO 并选择 **“编辑** ”：

![Editing a GPO settings](D:\Typora\保存文档\网络安全\assets\b71d8de9e74d129d0ad4142863deadc4.png)

将打开一个新窗口，我们可以在其中导航和编辑所有可用配置。要更改最小密码长度，请转到 `Computer Configurations -> Policies -> Windows Setting -> Security Settings -> Account Policies -> Password Policy` 并更改所需的策略值：

![Password policy GPO](D:\Typora\保存文档\网络安全\assets\bd3665c2569aa8fbe4f7482a5750f018.png)

#### GPO 分发

GPO 通过存储在 DC 中的名为 `SYSVOL` 的网络共享分发到网络。域中的所有用户通常都应该能够通过网络访问此共享，以便定期同步其 GPO。默认情况下，SYSVOL 共享点指向我们网络中每个 DC 上的 `C：\Windows\SYSVOL\sysvol\` 目录。

对任何 GPO 进行更改后，计算机可能需要长达 2 小时才能赶上进度。如果要强制任何特定计算机立即同步其 GPO，则始终可以在所需的计算机上运行以下命令：

```
PS C:\> gpupdate /force
```

#### 为 THM Inc. 创建一些 GPO

作为我们新工作的一部分，我们的任务是实施一些 GPO，以便我们能够：

1. 阻止非 IT 用户访问控制面板。
2. 让工作站和服务器在用户处于非活动状态 5 分钟后自动锁定屏幕，以避免人们在离开会话时暴露。

让我们关注其中的每一个，并定义我们应该在每个 GPO 中启用哪些策略以及它们应该链接到何处。

***限制对控制面板的访问\***

我们希望将所有计算机上对控制面板的访问限制为仅属于 IT 部门的用户。其他部门的用户应该无法更改系统的首选项。

让我们创建一个名为 `Restrict Control Panel Access（限制控制面板访问 `）的新 GPO 并打开它进行编辑。由于我们希望此 GPO 应用于特定用户，因此我们将在 `User Configuration （用户配置 `） 下查看以下策略：

![https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/9b333a11d12f05dd4413e3f208aab363.png](D:\Typora\保存文档\网络安全\assets\9b333a11d12f05dd4413e3f208aab363.png)

请注意，我们已启用 **“禁止访问控制面板和 PC 设置** ” 策略。

配置 GPO 后，我们需要将其链接到与不应有权访问其 PC 控制面板的用户对应的所有 OU。在这种情况下，我们将通过将 GPO 拖动到每个 OU 来链接 `Marketing`、`Management` 和 `Sales` OU：

![https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/4a8f727788731b7fbf87fc079682d1a6.png](D:\Typora\保存文档\网络安全\assets\4a8f727788731b7fbf87fc079682d1a6.png)

***自动锁屏 GPO\***

对于第一个 GPO， 关于工作站和服务器的屏幕锁定，我们可以直接将其应用于我们之前创建的`工作站 `、` 服务器`和`域控制器 `OU。

虽然此解决方案应该有效，但另一种选择包括简单地将 GPO 应用于根域，因为我们希望 GPO 影响我们所有的计算机。由于`工作站 `、` 服务器`和`域控制器 `OU 都是根域的子 OU，因此它们将继承其策略。

**注意：** 您可能会注意到，如果我们的 GPO 应用于根域，它也会被其他 OU（如 `Sales` 或 `Marketing`）继承。由于这些 OU 仅包含用户，因此 GPO 中的任何计算机配置都将被它们忽略。

让我们创建一个新的 GPO， 将其命名为 `Auto Lock Screen（自动锁屏界面 `），然后对其进行编辑。实现我们想要的策略位于以下路由中：

![Configuring machine inactivity limit](D:\Typora\保存文档\网络安全\assets\44c0cde18837cb6333c78749356ac0ee.png)

使用 Windows 域时，所有凭据都存储在域控制器中。每当用户尝试使用域凭据向服务进行身份验证时，服务都需要要求域控制器验证它们是否正确。两种协议可用于 Windows 域中的网络身份验证：

- **Kerberos：** 由任何最新版本的 Windows 使用。这是任何最近域中的默认协议。
- **网络 NTLM：** 出于兼容性目的而保留的旧式身份验证协议。

虽然 NetNTLM 应被视为过时，但大多数网络将启用这两种协议。让我们更深入地了解这些协议中的每一个是如何工作的。

**Kerberos 认证**

使用 Kerberos 进行身份验证时，将发生以下过程：

1. 用户使用从其密码派生的密钥加密的用户名和时间戳发送到**密钥分发中心 （KDC），** 该服务通常安装在负责在网络上创建 Kerberos 票证的域控制器上。

   KDC 将创建并发回票**证授予票证  **Ticket Granting Ticket** （TGT），** 该票证将允许用户请求额外的票证以访问特定服务。需要票证来获得更多票证可能听起来有点奇怪，但它允许用户在每次想要连接到服务时无需传递其凭据即可请求服务票证。除了 TGT 之外，还向用户提供一个**会话密钥** ，他们需要该密钥来生成以下请求。

   请注意，TGT 使用 **krbtgt** 帐户的密码哈希进行加密，因此用户无法访问其内容。必须知道，加密的 TGT 包含会话密钥的副本作为其内容的一部分，并且 KDC 无需存储会话密钥，因为它可以在需要时通过解密 TGT 来恢复副本。

   ![https://tryhackme-images.s3.amazonaws.com/user-uploads/5ed5961c6276df568891c3ea/room-content/d36f5a024c20fb480cdae8cd09ddc09f.png](D:\Typora\保存文档\网络安全\assets\d36f5a024c20fb480cdae8cd09ddc09f.png)

1. 当用户想要连接到网络上的服务（如共享、网站或数据库）时，他们将使用其 TGT 向 KDC 请求**票证授予服务 （TGS）。**TGS 是仅允许连接到为其创建的特定服务的票证。要请求 TGS，用户将发送其用户名和使用会话密钥加密的时间戳，以及 TGT 和服务**主体名称 （SPN），该名称**  **Service Principal Name**指示我们打算访问的服务和服务器名称。

   因此，KDC 将向我们发送一个 TGS 以及**一个服务会话密钥** ，我们需要对要访问的服务进行身份验证。TGS 使用**从服务所有者哈希**派生的 密钥进行加密。服务所有者是运行服务的用户或计算机帐户。TGS 在其加密内容上包含服务会话密钥的副本，以便服务所有者可以通过解密 TGS 来访问它。![Kerberos step 2](D:\Typora\保存文档\网络安全\assets\84504666e78373c613d3e05d176282dc.png)

1. 然后，可以将 TGS 发送到所需的服务以进行身份验证并建立连接。该服务将使用其配置的账户的密码哈希来解密 TGS 并验证服务会话密钥。![Kerberos step 3](D:\Typora\保存文档\网络安全\assets\8fbf08d03459c1b792f3b6efa4d7f285.png)

#### netNTLM

![NetNTLM authentication](D:\Typora\保存文档\网络安全\assets\2eab5cacbd0d3e9dc9afb86169b711ec.png)

1. 客户端向他们要访问的服务器发送身份验证请求。
2. 服务器生成一个随机数并将其作为质询发送给客户端。
3. 客户端将其 NTLM 密码哈希与质询 （和其他已知数据） 相结合，以生成对质询的响应，并将其发送回服务器进行验证。
4. 服务器将质询和响应转发给域控制器进行验证。
5. 域控制器使用质询重新计算响应，并将其与客户端发送的原始响应进行比较。如果它们都匹配，则对客户端进行身份验证;否则，将拒绝访问。身份验证结果将发送回服务器。
6. 服务器将鉴权结果转发给客户端。

请注意，为了安全起见，用户的密码（或哈希值）绝不会通过网络传输。

**注意：** 所述过程在使用域帐户时适用。如果使用本地帐户，则服务器可以验证对质询本身的响应，而无需与域控制器交互，因为它的密码哈希存储在本地 SAM 上

## 浏览器使用  主要是收集信息//重要

让我们考虑一下 Google 支持的搜索运算符。

- `“exact phrase”`：双引号表示您正在查找包含确切单词或短语的页面。例如，人们可能会搜索 `“passive reconnaissance”` 来获取包含此确切短语的页面。
- `site：`： 此运算符允许您指定要将搜索限制到的域名。例如，我们可以使用 在 TryHackMe 上搜索 `site:tryhackme.com success stories` 成功案例。
- `-`：减号允许您省略包含特定单词或短语的搜索结果。例如，您可能对了解金字塔感兴趣，但不想查看旅游网站;一种方法是搜索 `pyramids -tourism` 或 `-tourism pyramids`。
- `filetype：`： 此搜索运算符对于查找文件而不是网页是必不可少的。您可以使用 Google 搜索的一些文件类型是可移植文档格式 （PDF）、Microsoft Word 文档 （DOC）、Microsoft Excel 电子表格 （XLS） 和 Microsoft PowerPoint 演示文稿 （PPT）。例如，要查找网络安全演示文稿，请尝试搜索 `filetype：ppt cyber security`。

您可以在此[高级搜索运算符列表中](https://github.com/cipher387/Advanced-search-operators-list)查看各种搜索引擎中的更高级控件;但是，以上提供了一个很好的起点。检查您最喜欢的搜索引擎，了解支持的搜索运算符。

### Shodan 

让我们从 [Shodan](https://www.shodan.io/) 开始，这是一个用于连接到 Internet 的设备的搜索引擎。**它允许您搜索特定类型和版本的服务器、网络设备、工业控制系统和 IoT 设备。您可能希望查看仍有多少服务器仍在运行 Apache 2.4.1 以及各个国家/地区的分布情况。**要找到答案，我们可以搜索 `apache 2.4.1`，**它将返回标头中包含字符串“apache 2.4.1”的服务器列表**

![The results of searching for apache 2.4.1 on the Shodan website.](D:\Typora\保存文档\网络安全\assets\5f04259cf9bf5b57aed2c476-1718112514634.png)

### Censys

乍一看，[Censys](https://search.censys.io/) 似乎与 Shodan 相似。但是，Shodan 专注于连接互联网的设备和系统，例如服务器、路由器、网络摄像头和 IoT 设备。另一方面，Censys 专注于连接 Internet 的主机、网站、证书和其他 Internet 资产。它的一些用例包括枚举正在使用的域、审计开放端口和服务以及发现网络中的流氓资产。您可能需要查看 [Censys 介绍性用例 ](https://docs.censys.com/docs/ls-introductory-use-cases#/)![The results of searching for apache 2.4.1 on the Censys website.](D:\Typora\保存文档\网络安全\assets\5f04259cf9bf5b57aed2c476-1718112720346.png)





### VirusTotal

[VirusTotal](https://www.virustotal.com/) 是一个在线网站，**它使用多个防病毒引擎为文件提供病毒扫描服务。它允许用户上传文件或提供 URL，以便在一次作中针对众多防病毒引擎和网站扫描程序对其进行扫描。他们甚至可以输入文件哈希值来检查以前上传的文件的结果。**

下面的屏幕截图显示了根据 67 个防病毒引擎检查提交的文件的结果。此外，您可以查看社区的评论以获得更多见解。有时，文件可能会被标记为病毒或特洛伊木马程序;但是，由于各种原因，这可能不准确，这时社区成员可以提供更深入的解释。

### Have I Been Pwned

[Have I Been Pwned](https://haveibeenpwned.com/) （HIBP） 只做一件事;它会告诉您电子邮件地址是否出现在数据泄露事件中。在泄露的数据中找到一个人的电子邮件表明私人信息泄露，更重要的是，密码泄露。许多用户在多个平台上使用相同的密码，如果一个平台被泄露，他们在其他平台上的密码也会暴露。事实上，密码通常以加密格式存储;但是，许多密码并不那么复杂，可以使用各种攻击来恢复。

### CVE 漏洞  //重要

我们可以将 Common Vulnerabilities and Exposures （CVE） 程序视为漏洞字典。它为软件和硬件产品中的漏洞和安全问题提供标准化标识符。每个漏洞都分配有一个采用标准化格式（如 `CVE-2024-29988`）的 CVE ID。此唯一标识符 （CVE ID） 可确保从安全研究人员到供应商和 IT 专业人员的每个人都引用相同的漏洞，在本例中为 [CVE-2024-29988](https://nvd.nist.gov/vuln/detail/CVE-2024-29988)。

**MITRE Corporation 维护 CVE 系统。有关更多信息和搜索现有 CVE，请访问 [CVE 计划 ](https://www.cve.org/)Web 站点。或者，访问[国家漏洞数据库 ](https://nvd.nist.gov/)（NVD） 网站。下面的屏幕截图显示了 CVE-2014-0160，也称为 Heartbleed。**

### Exploit Database  漏洞利用数据库

您想要利用易受攻击的应用程序的原因有很多;一种是将公司的安全性作为其红队的一部分进行评估。不用说，除非我们得到许可，否则我们不应该试图利用易受攻击的系统，通常是通过具有法律约束力的协议。

**现在我们有权利用易受攻击的系统，我们可能需要找到一个有效的漏洞利用代码。一种资源是 [Exploit Database](https://www.exploit-db.com/)。漏洞利用数据库列出了来自不同作者的漏洞利用代码;其中一些漏洞利用代码已经过测试并标记为已验证。**

![The results of the search for heartbleed on the Exploit Database website](D:\Typora\保存文档\网络安全\assets\5f04259cf9bf5b57aed2c476-1718112752814.png)

有数十亿用户在 [Facebook](https://www.facebook.com/people/Tryhackme/100069557747714/)、[Twitter](https://twitter.com/RealTryHackMe) 和 [LinkedIn](https://www.linkedin.com/company/tryhackme/) 等社交媒体平台上注册。我们希望您熟悉流行的平台。**但是，如果您知道任何不熟悉的平台，我们建议您查看并了解它**。理想情况下，人们希望在不创建帐户的情况下探索平台;但是，这会严重限制您的体验。相反，一个建议是使用临时电子邮件地址来发现这些平台，而无需将它们链接到您的真实电子邮件地址;完成后，您可以终止账户和关联的电子邮件地址。不使用您的主要帐户的一个原因是，当您只是暂时探索平台时，您不希望您的联系人开始在那里与您联系。

**社交媒体的力量在于它可以让您与您感兴趣的公司和人建立联系。此外，社交媒体为网络安全专业人士提供了丰富的信息，无论他们是搜索人员还是技术信息。你会问为什么搜索人很重要？**

**在保护公司时，您应该确保您保护的人不会在社交媒体上过度分享。例如，他们的社交媒体可能会泄露他们秘密问题的答案，例如，“你小时候上过哪所学校？此类信息可能允许攻击者重置其密码并轻松接管其帐户。**

此外，作为网络安全专业人士，您希望随时了解新的网络安全趋势、技术和产品。遵循适当的渠道和小组可以为增长您的技术专业知识提供合适的环境。

除了通过社交媒体渠道和群组保持更新外，**我们还应该提及新闻媒体。数百个新闻网站将提供有价值的网络安全相关新闻。尝试不同的，并坚持你最喜欢的。**















